---
layout: default
title: Tips for existing Kanata users
description: Use your existing Kanata config.kbd in KeyPath
---

<div class="migration-hero">
  <h1>Power of Kanata.<br>Ease of a Mac app.</h1>
  <p class="migration-hero-subtitle">Keep your config. Let KeyPath handle the rest.</p>
</div>

If you're already using Kanata on macOS, KeyPath can run your existing configuration with minimal changes. This guide shows you how to migrate your setup.

## Quick Start

**The simplest path:** Place your existing Kanata config at KeyPath's expected location and add a single include line.

1. **Copy your config** to `~/.config/keypath/keypath.kbd`
2. **Add this line at the top** of your config:
   ```lisp
   (include keypath-apps.kbd)
   ```
3. **Run KeyPath's setup wizard** - it will handle permissions, services, and drivers automatically

That's it! KeyPath will:
- Generate `keypath-apps.kbd` for app-specific rules (if you use KeyPath's UI)
- Preserve all your existing Kanata configuration
- Hot-reload changes via TCP (default port 37001)

## Understanding the Two-File Model

KeyPath uses a two-file configuration model:

```text
~/.config/keypath/
  keypath-apps.kbd    ← KeyPath owns (regenerated automatically)
  keypath.kbd         ← You own (preserved, never overwritten)
```

### File Ownership

- **`keypath-apps.kbd`**: Generated by KeyPath for app-specific rules. KeyPath regenerates this file when you use the UI to configure app-specific keymaps. You should not edit this file manually.

- **`keypath.kbd`**: Your user-owned configuration file. KeyPath preserves everything you write here. If you use KeyPath's UI for basic remapping, those rules are written to managed sections (marked with `;; === KEYPATH MANAGED ===`), but your custom sections are always preserved.

### The Include Pattern

Your `keypath.kbd` should include KeyPath's generated file at the top:

```lisp
(include keypath-apps.kbd)

;; Your custom configuration below
(defalias
  my-custom-alias (layer-toggle nav)
)

(deflayer base
  @my-custom-alias  ;; ... rest of your layer
)
```

**Why this works:** Kanata processes includes before evaluating the rest of your config, so KeyPath's app-specific virtual keys are available for your custom rules to reference.

## Migration Checklist

1. **Backup your existing config** — Always keep a backup before migrating
2. **Copy config to KeyPath location** — `~/.config/keypath/keypath.kbd`
3. **Add include line** — `(include keypath-apps.kbd)` at the top
4. **Run KeyPath setup wizard** — Handles permissions, services, drivers
5. **Verify TCP is enabled** — KeyPath needs TCP for validation and overlay (default port 37001)
6. **Test your remappings** — Ensure everything works as expected

## Common Patterns & KeyPath Compatibility

### Includes

**Your existing includes work fine:**
```lisp
(include keypath-apps.kbd)
(include ~/.config/kanata/my-layers.kbd)
(include ~/.config/kanata/my-aliases.kbd)
```

**Important:** Place `(include keypath-apps.kbd)` first so KeyPath's virtual keys are available.

### Device Filtering

KeyPath doesn't interfere with `defcfg` device filtering:

```lisp
(defcfg
  process-unmapped-keys yes
  device-if "my-keyboard"
)
```

Your device filters work exactly as they did with standalone Kanata.

### Layers & Aliases

All standard Kanata features work:

- **Layers**: `(deflayer base ...)`, `(deflayer nav ...)`
- **Aliases**: `(defalias ...)`
- **Tap-hold**: `(tap-hold ...)`, `(tap-hold-release ...)`
- **Tap-dance**: `(tap-dance ...)`
- **Macros**: `(multi ...)`
- **Variables**: `(defvar ...)`

### TCP Requirements

**KeyPath requires TCP to be enabled** for:
- Config validation (checks syntax before applying)
- Overlay UI (shows active layer and key mappings)
- Diagnostics (service health checks)

Your config should include TCP settings in `defcfg`:

```lisp
(defcfg
  process-unmapped-keys yes
  tcp-server-port 37001
)
```

**Note:** If you don't specify a port, KeyPath's setup wizard will add TCP configuration automatically. If you use a custom port, update KeyPath's service configuration to match.

### Command Execution Requirements

**KeyPath requires `danger-enable-cmd yes`** for app launching and URL opening features. This is Kanata's built-in safety gate — disabled by default so random configs from the internet can't execute arbitrary commands.

```lisp
(defcfg
  process-unmapped-keys yes
  tcp-server-port 37001
  danger-enable-cmd yes  ;; Required for KeyPath app/URL launching
)
```

**Why it's named "danger":** Kanata's `cmd` action can execute *any* binary with *any* arguments. The scary name is intentional — it forces you to acknowledge you're enabling command execution. KeyPath uses this for legitimate app launching via macOS's `open` command, but Kanata itself applies no restrictions once enabled.

### Script Execution Safety

If you use KeyPath's `script:{path}` action URI to run scripts, KeyPath applies several safety layers **on top of** Kanata's `cmd`:

| Safety Measure | Description |
|----------------|-------------|
| **Disabled by default** | Script execution is off until you enable it in Settings |
| **File-type whitelist** | Only recognized types: `.applescript`, `.scpt`, `.sh`, `.bash`, `.zsh`, `.py`, `.rb`, `.pl`, `.lua` |
| **First-run confirmation** | Dialog shown before first script execution |
| **Audit logging** | All script executions logged (last 100 entries) |
| **No shell injection** | Scripts run via direct interpreter, not shell — no metacharacter attacks |

**Note:** These protections apply only to KeyPath's action system. If you write raw `(cmd ...)` actions in your Kanata config, those bypass KeyPath entirely and run with whatever permissions Kanata has.

## KeyPath Limitations & Non-Goals

### What KeyPath Does NOT Do

1. **No config parsing/importing into UI**
   - KeyPath does not parse your Kanata config to populate the UI
   - The UI shows only rules created through KeyPath's interface
   - Your BYOC (Bring Your Own Config) rules are invisible to the UI

2. **UI may not reflect BYOC rules**
   - The overlay/mapper views may show limited or approximate data
   - KeyPath uses TCP + simulator to understand config state, not parsing
   - Complex aliases or macros may not display correctly in the UI

3. **KeyPath-managed sections may be regenerated**
   - If you use KeyPath's UI, managed sections (marked with `;; === KEYPATH MANAGED ===`) are overwritten on save
   - Your custom sections (outside managed blocks) are always preserved
   - See [ADR-025]({{ site.github_url }}/blob/main/docs/adr/adr-025-config-management.md) for details

4. **No config translation**
   - KeyPath does not convert your Kanata config into UI rules
   - You can't "import" existing remappings into KeyPath's visual editor
   - Use KeyPath's UI for new rules, keep existing rules in your config file

### What Still Works with BYOC

Even with a BYOC setup, KeyPath still provides:

- ✅ **Service management** - Automatic LaunchDaemon setup and monitoring
- ✅ **Permission handling** - Guided wizard for Input Monitoring and Accessibility
- ✅ **Driver management** - Automatic Karabiner VirtualHID driver installation
- ✅ **Hot reload** - Changes to your config file are detected and reloaded via TCP
- ✅ **Conflict detection** - Detects and resolves conflicts with other remappers
- ✅ **Health monitoring** - Service status checks and automatic recovery
- ✅ **Emergency stop** - `Ctrl + Space + Esc` to disable all remappings

### When You Might Hit Limitations

**You'll notice limitations if:**

- You expect KeyPath's UI to show your custom rules (it won't - BYOC rules are invisible to UI)
- You want to edit complex aliases/macros through the UI (use your text editor instead)
- You need KeyPath to understand your layer structure for the overlay (it uses TCP/simulator, which may miss edge cases)

**You won't notice limitations if:**

- You're happy editing your config file directly (KeyPath preserves it)
- You use KeyPath primarily for service management and permissions
- You add new simple remappings through KeyPath's UI while keeping complex rules in your config

## Troubleshooting

### Config Not Loading?

1. **Check TCP is enabled** - KeyPath needs TCP for validation
2. **Verify include path** - `keypath-apps.kbd` must be in the same directory
3. **Check logs** - `tail -f /var/log/com.keypath.kanata.stdout.log`
4. **Run setup wizard** - File → Run Setup Wizard to check for issues

### KeyPath Overwrites My Config?

KeyPath only overwrites sections marked with `;; === KEYPATH MANAGED ===`. Your custom sections are preserved. If you see unexpected changes:

1. Check if you're editing in a managed section
2. Use KeyPath's UI for new rules, edit your config file for custom rules
3. See [ADR-025]({{ site.github_url }}/blob/main/docs/adr/adr-025-config-management.md) for the preservation model

### TCP Port Conflicts?

If you use a custom TCP port:

1. Update your `defcfg` to match KeyPath's service configuration
2. Or let KeyPath use the default port (37001) and update your config
3. Run the setup wizard to synchronize TCP settings

### Service Not Starting?

1. **Check permissions** - Run setup wizard to verify Input Monitoring and Accessibility
2. **Check conflicts** - Wizard detects conflicting processes (Karabiner, orphaned Kanata)
3. **Check logs** - View system logs for error messages
4. **Use Fix button** - Wizard's Fix button resolves most issues automatically

## Advanced: Using Symlinks

If you prefer to keep your config in a dotfiles repository or custom location, you can use a symlink:

```bash
# Create KeyPath's config directory
mkdir -p ~/.config/keypath

# Create symlink to your existing config
ln -s ~/.config/kanata/my-config.kbd ~/.config/keypath/keypath.kbd
```

**Important:** Ensure `keypath-apps.kbd` is accessible at the symlink location (same directory). KeyPath generates it in `~/.config/keypath/`, so if your symlink points elsewhere, the include may fail.

**Recommendation:** Use KeyPath's wizard "symlink" option (if available) or copy your config instead of symlinking to avoid path resolution issues.

---

## More things KeyPath can do

Beyond the core features, KeyPath offers these additional capabilities:

<div class="geometric-section geometric-section-compact">
<div class="geometric-grid">

<!-- One-Shot Modifiers -->
<div class="geo-card" data-feature="one-shot" data-geo>
  <svg viewBox="0 0 280 160">
    <circle class="geo-timer-ring" cx="140" cy="80" r="20"/>
    <circle class="geo-timer-fill" cx="140" cy="80" r="20"/>
    <rect class="geo-key" x="80" y="55" width="50" height="50" rx="8"/>
    <text class="geo-key-label" x="105" y="80">⇧</text>
    <rect class="geo-key" x="150" y="55" width="50" height="50" rx="8"/>
    <text class="geo-key-label" x="175" y="80">A</text>
  </svg>
  <h3>One-Shot Modifiers</h3>
  <p>Tap Shift once, and the next key is shifted. No holding required. Pure flow.</p>
</div>

<!-- Combos -->
<div class="geo-card" data-feature="combos" data-geo>
  <svg viewBox="0 0 280 160">
    <rect class="geo-key" x="30" y="55" width="45" height="50" rx="8"/>
    <text class="geo-key-label" x="52" y="80">J</text>
    <text class="geo-plus" x="95" y="80">+</text>
    <rect class="geo-key" x="115" y="55" width="45" height="50" rx="8"/>
    <text class="geo-key-label" x="137" y="80">K</text>
    <line class="geo-equals" x1="175" y1="75" x2="195" y2="75"/>
    <line class="geo-equals" x1="175" y1="85" x2="195" y2="85"/>
    <rect class="geo-key active" x="205" y="55" width="45" height="50" rx="8"/>
    <text class="geo-key-label" x="227" y="80" fill="#FFF">ESC</text>
  </svg>
  <h3>Combos</h3>
  <p>Press two keys simultaneously for a third action. Create shortcuts that feel natural.</p>
</div>

<!-- Caps Word -->
<div class="geo-card" data-feature="caps-word" data-geo>
  <svg viewBox="0 0 280 160">
    <text class="geo-text" x="140" y="70">hello</text>
    <text class="geo-text" x="140" y="100" fill="#0071E3" font-weight="600">HELLO</text>
    <line stroke="#0071E3" stroke-width="2" x1="90" y1="85" x2="190" y2="85" opacity="0.3"/>
  </svg>
  <h3>Caps Word</h3>
  <p>Capitalize just the next word, then return to normal. Perfect for CONSTANTS and Names.</p>
</div>

<!-- Mouse Keys -->
<div class="geo-card" data-feature="mouse-keys" data-geo>
  <svg viewBox="0 0 280 160">
    <path class="geo-trail" d="M80 80 Q120 60 160 100"/>
    <polygon class="geo-cursor" points="0,0 0,18 5,14 9,22 12,21 8,13 14,10"/>
  </svg>
  <h3>Mouse Keys</h3>
  <p>Control your cursor from the keyboard. Navigate without ever leaving home row.</p>
</div>

<!-- Sequences -->
<div class="geo-card" data-feature="sequences" data-geo>
  <svg viewBox="0 0 280 160">
    <g class="geo-seq-key">
      <rect class="geo-key" x="30" y="55" width="40" height="50" rx="8"/>
      <text class="geo-key-label" x="50" y="80">A</text>
    </g>
    <g class="geo-seq-key">
      <rect class="geo-key" x="80" y="55" width="40" height="50" rx="8"/>
      <text class="geo-key-label" x="100" y="80">D</text>
    </g>
    <g class="geo-seq-key">
      <rect class="geo-key" x="130" y="55" width="40" height="50" rx="8"/>
      <text class="geo-key-label" x="150" y="80">D</text>
    </g>
    <g class="geo-seq-key">
      <rect class="geo-key active" x="180" y="55" width="70" height="50" rx="8"/>
      <text class="geo-key-label" x="215" y="72" fill="#FFF" font-size="9">141</text>
      <text class="geo-key-label" x="215" y="88" fill="#FFF" font-size="9">Mansfield</text>
    </g>
  </svg>
  <h3>Sequences</h3>
  <p>Type abbreviations that expand to full text. "addr" becomes your full address.</p>
</div>

<!-- Custom Rules -->
<div class="geo-card" data-feature="custom-rules" data-geo>
  <svg viewBox="0 0 280 160">
    <rect class="geo-key" x="30" y="30" width="60" height="35" rx="6"/>
    <text class="geo-key-label" x="60" y="52" font-size="10">CAPS</text>
    <text x="100" y="52" font-size="14" fill="#0071E3">→</text>
    <text x="125" y="52" font-size="12" fill="#0071E3" font-weight="600">ESC</text>
    <rect x="30" y="75" width="50" height="25" rx="5" fill="#FF9500" opacity="0.2"/>
    <text x="55" y="92" font-size="10" fill="#FF9500" text-anchor="middle" font-weight="500">!@#$</text>
    <text x="90" y="92" font-size="10" fill="#86868B">Symbol Layer</text>
    <rect x="30" y="110" width="50" height="25" rx="5" fill="#5856D6" opacity="0.2"/>
    <text x="55" y="127" font-size="10" fill="#5856D6" text-anchor="middle" font-weight="500">1234</text>
    <text x="90" y="127" font-size="10" fill="#86868B">Number Layer</text>
    <text x="200" y="90" font-size="24" fill="#E8E8ED">...</text>
  </svg>
  <h3>Custom Rules</h3>
  <p>Caps Lock to Escape, symbol layers, number pads, and more. Build exactly the keyboard you want.</p>
</div>

<!-- App-Specific -->
<div class="geo-card" data-feature="app-specific" data-geo>
  <svg viewBox="0 0 280 160">
    <circle class="geo-app-ring" cx="90" cy="80" r="35"/>
    <g class="geo-app-icon">
      <circle cx="90" cy="80" r="25" fill="url(#safariGradient2)"/>
      <polygon points="90,58 94,80 90,102 86,80" fill="#FFFFFF"/>
      <polygon points="90,58 94,80 90,80" fill="#FF3B30"/>
      <circle cx="90" cy="80" r="4" fill="#FFFFFF"/>
    </g>
    <circle class="geo-app-ring" cx="190" cy="80" r="35"/>
    <g class="geo-app-icon">
      <rect x="165" y="55" width="50" height="50" rx="8" fill="#007ACC"/>
      <path d="M175 70 L185 80 L175 90 M185 80 L205 65 L205 95 L185 80" fill="none" stroke="#FFFFFF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    </g>
    <defs>
      <linearGradient id="safariGradient2" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#5AC8FA"/>
        <stop offset="100%" style="stop-color:#007AFF"/>
      </linearGradient>
    </defs>
  </svg>
  <h3>App-Specific</h3>
  <p>Different apps, different layouts. Automatically switch when you switch windows.</p>
</div>

<!-- Live Reload -->
<div class="geo-card" data-feature="live-reload" data-geo>
  <svg viewBox="0 0 280 160">
    <circle cx="140" cy="80" r="30" fill="none" stroke="#E8E8ED" stroke-width="2"/>
    <path class="geo-reload-arrow" d="M140 50 A30 30 0 1 1 110 80 M110 80 L110 70 M110 80 L120 80"/>
    <circle cx="140" cy="80" r="8" fill="#0071E3"/>
  </svg>
  <h3>Live Reload</h3>
  <p>Edit your config, see changes instantly. No restart required. Iterate at the speed of thought.</p>
</div>

<!-- Open URLs -->
<div class="geo-card" data-feature="open-url" data-geo>
  <svg viewBox="0 0 280 160">
    <rect class="geo-key" x="30" y="55" width="50" height="50" rx="8"/>
    <text class="geo-key-label" x="55" y="80">G</text>
    <path class="geo-arrow" d="M90 80 L140 80 L135 75 M140 80 L135 85"/>
    <g class="geo-app-icon">
      <circle cx="190" cy="80" r="28" fill="none" stroke="#0071E3" stroke-width="2.5"/>
      <ellipse cx="190" cy="80" rx="12" ry="28" fill="none" stroke="#0071E3" stroke-width="2"/>
      <line x1="162" y1="80" x2="218" y2="80" stroke="#0071E3" stroke-width="2"/>
      <path d="M165 68 Q190 64 215 68" fill="none" stroke="#0071E3" stroke-width="1.5"/>
      <path d="M165 92 Q190 96 215 92" fill="none" stroke="#0071E3" stroke-width="1.5"/>
    </g>
  </svg>
  <h3>Open URLs</h3>
  <p>Launch websites directly from your keyboard. GitHub, docs, dashboards—one key away.</p>
</div>

<!-- Multi-Display -->
<div class="geo-card" data-feature="multi-display" data-geo>
  <svg viewBox="0 0 280 160">
    <rect x="20" y="40" width="100" height="70" rx="6" fill="none" stroke="#D2D2D7" stroke-width="2"/>
    <rect x="60" y="110" width="20" height="8" fill="#D2D2D7"/>
    <rect x="160" y="40" width="100" height="70" rx="6" fill="none" stroke="#D2D2D7" stroke-width="2"/>
    <rect x="200" y="110" width="20" height="8" fill="#D2D2D7"/>
    <rect class="geo-moving-window" x="35" y="50" width="40" height="30" rx="3" fill="#0071E3" opacity="0.8"/>
    <path class="geo-arrow" d="M125 75 L155 75 L150 70 M155 75 L150 80" stroke-width="2.5"/>
    <text class="geo-key-label" x="140" y="130" font-size="12" fill="#86868B">] next display</text>
  </svg>
  <h3>Multi-Display</h3>
  <p>Move windows between monitors instantly. Navigate your multi-display setup from the keyboard.</p>
</div>

<!-- Spaces -->
<div class="geo-card" data-feature="spaces" data-geo>
  <svg viewBox="0 0 280 160">
    <g transform="translate(40, 60)">
      <rect x="0" y="0" width="50" height="40" rx="4" fill="#E8E8ED" stroke="#D2D2D7" stroke-width="1"/>
      <text class="geo-key-label" x="25" y="25" font-size="10" fill="#86868B">1</text>
    </g>
    <g transform="translate(60, 50)">
      <rect x="0" y="0" width="50" height="40" rx="4" fill="#0071E3" stroke="#0077ED" stroke-width="2"/>
      <text class="geo-key-label" x="25" y="25" font-size="10" fill="#FFF">2</text>
    </g>
    <g transform="translate(80, 60)">
      <rect x="0" y="0" width="50" height="40" rx="4" fill="#E8E8ED" stroke="#D2D2D7" stroke-width="1"/>
      <text class="geo-key-label" x="25" y="25" font-size="10" fill="#86868B">3</text>
    </g>
    <path class="geo-arrow" d="M160 70 L200 70 L195 65 M200 70 L195 75"/>
    <rect class="geo-space-window" x="210" y="50" width="40" height="30" rx="3" fill="#0071E3" opacity="0.8"/>
    <text class="geo-key-label" x="140" y="130" font-size="12" fill="#86868B">S → next Space</text>
  </svg>
  <h3>Spaces</h3>
  <p>Move windows between macOS Spaces. Organize your virtual desktops without Mission Control.</p>
</div>

<!-- Notifications -->
<div class="geo-card" data-feature="notify" data-geo>
  <svg viewBox="0 0 280 160">
    <g class="geo-notification">
      <rect x="60" y="35" width="160" height="60" rx="12" fill="#FFFFFF" stroke="#E8E8ED" stroke-width="1"/>
      <rect x="75" y="50" width="30" height="30" rx="7" fill="#0071E3"/>
      <text x="90" y="70" font-size="14" fill="#FFF" text-anchor="middle" dominant-baseline="central">⌨</text>
      <text x="115" y="58" font-size="11" font-weight="600" fill="#1D1D1F">Layer Changed</text>
      <text x="115" y="75" font-size="10" fill="#86868B">Navigation mode active</text>
    </g>
    <g transform="translate(130, 105)">
      <path d="M10 0 L10 3 M10 17 L10 20 M3 10 L0 10 M17 10 L20 10" stroke="#0071E3" stroke-width="1.5" stroke-linecap="round"/>
      <circle cx="10" cy="10" r="6" fill="none" stroke="#0071E3" stroke-width="1.5"/>
    </g>
  </svg>
  <h3>Notifications</h3>
  <p>Get visual feedback for layer changes, actions, and events. Stay informed without breaking flow.</p>
</div>

<!-- Deep Linking -->
<div class="geo-card" data-feature="deep-link" data-geo>
  <svg viewBox="0 0 280 160">
    <g class="geo-external-apps">
      <rect x="40" y="50" width="40" height="40" rx="8" fill="#FF6363"/>
      <path d="M50 70 L70 70 M60 60 L60 80" stroke="#FFF" stroke-width="3" stroke-linecap="round"/>
      <rect x="95" y="50" width="40" height="40" rx="8" fill="#5C1F87"/>
      <circle cx="115" cy="70" r="10" fill="#FFF"/>
      <rect x="150" y="50" width="40" height="40" rx="8" fill="#1D1D1F"/>
      <text x="170" y="75" font-size="16" fill="#34C759" text-anchor="middle">$_</text>
    </g>
    <path class="geo-arrow" d="M60 95 L100 115 M115 95 L115 115 M170 95 L130 115"/>
    <rect x="100" y="115" width="30" height="30" rx="6" fill="#0071E3"/>
    <text x="115" y="135" font-size="12" fill="#FFF" text-anchor="middle">K</text>
  </svg>
  <h3>Deep Linking</h3>
  <p>Trigger KeyPath from Raycast, Alfred, or Terminal. Integrate with your favorite tools.</p>
</div>

</div>
</div>

---

## Next Steps

- **Read the [Architecture Overview]({{ '/architecture/overview' | relative_url }})** — Understand how KeyPath works
- **Check [ADR-027]({{ site.github_url }}/blob/main/docs/adr/adr-027-app-specific-keymaps.md)** — Details on the two-file model
- **See [ADR-023]({{ site.github_url }}/blob/main/docs/adr/adr-023-no-config-parsing.md)** — Why KeyPath doesn't parse configs
- **Review [ADR-025]({{ site.github_url }}/blob/main/docs/adr/adr-025-config-management.md)** — How config preservation works

## Getting Help

- **GitHub Issues**: [Report bugs or ask questions]({{ site.github_url }}/issues)
- **FAQ**: [Frequently asked questions]({{ '/faq' | relative_url }})
- **Debugging Guide**: [Advanced troubleshooting]({{ '/guides/debugging' | relative_url }})
