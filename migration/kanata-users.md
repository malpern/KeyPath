---
layout: default
title: Tips for existing Kanata users
description: Use your existing Kanata config.kbd in KeyPath
---

# Tips for existing Kanata users
Looking for the high-level pitch first? Start with **[KeyPath for Kanata users](/kanata)**.

If you're already using Kanata on macOS, KeyPath can run your existing configuration with minimal changes. This guide shows you how to migrate your setup.

## Quick Start

**The simplest path:** Place your existing Kanata config at KeyPath's expected location and add a single include line.

1. **Copy your config** to `~/.config/keypath/keypath.kbd`
2. **Add this line at the top** of your config:
   ```lisp
   (include keypath-apps.kbd)
   ```
3. **Run KeyPath's setup wizard** - it will handle permissions, services, and drivers automatically

That's it! KeyPath will:
- Generate `keypath-apps.kbd` for app-specific rules (if you use KeyPath's UI)
- Preserve all your existing Kanata configuration
- Hot-reload changes via TCP (default port 37001)

## Understanding the Two-File Model

KeyPath uses a two-file configuration model:

```text
~/.config/keypath/
  keypath-apps.kbd    ← KeyPath owns (regenerated automatically)
  keypath.kbd         ← You own (preserved, never overwritten)
```

### File Ownership

- **`keypath-apps.kbd`**: Generated by KeyPath for app-specific rules. KeyPath regenerates this file when you use the UI to configure app-specific keymaps. You should not edit this file manually.

- **`keypath.kbd`**: Your user-owned configuration file. KeyPath preserves everything you write here. If you use KeyPath's UI for basic remapping, those rules are written to managed sections (marked with `;; === KEYPATH MANAGED ===`), but your custom sections are always preserved.

### The Include Pattern

Your `keypath.kbd` should include KeyPath's generated file at the top:

```lisp
(include keypath-apps.kbd)

;; Your custom configuration below
(defalias
  my-custom-alias (layer-toggle nav)
)

(deflayer base
  @my-custom-alias  ;; ... rest of your layer
)
```

**Why this works:** Kanata processes includes before evaluating the rest of your config, so KeyPath's app-specific virtual keys are available for your custom rules to reference.

## Migration Checklist

1. **Backup your existing config** — Always keep a backup before migrating
2. **Copy config to KeyPath location** — `~/.config/keypath/keypath.kbd`
3. **Add include line** — `(include keypath-apps.kbd)` at the top
4. **Run KeyPath setup wizard** — Handles permissions, services, drivers
5. **Verify TCP is enabled** — KeyPath needs TCP for validation and overlay (default port 37001)
6. **Test your remappings** — Ensure everything works as expected

## Common Patterns & KeyPath Compatibility

### Includes

**Your existing includes work fine:**
```lisp
(include keypath-apps.kbd)
(include ~/.config/kanata/my-layers.kbd)
(include ~/.config/kanata/my-aliases.kbd)
```

**Important:** Place `(include keypath-apps.kbd)` first so KeyPath's virtual keys are available.

### Device Filtering

KeyPath doesn't interfere with `defcfg` device filtering:

```lisp
(defcfg
  process-unmapped-keys yes
  device-if "my-keyboard"
)
```

Your device filters work exactly as they did with standalone Kanata.

### Layers & Aliases

All standard Kanata features work:

- **Layers**: `(deflayer base ...)`, `(deflayer nav ...)`
- **Aliases**: `(defalias ...)`
- **Tap-hold**: `(tap-hold ...)`, `(tap-hold-release ...)`
- **Tap-dance**: `(tap-dance ...)`
- **Macros**: `(multi ...)`
- **Variables**: `(defvar ...)`

### TCP Requirements

**KeyPath requires TCP to be enabled** for:
- Config validation (checks syntax before applying)
- Overlay UI (shows active layer and key mappings)
- Diagnostics (service health checks)

Your config should include TCP settings in `defcfg`:

```lisp
(defcfg
  process-unmapped-keys yes
  tcp-server-port 37001
)
```

**Note:** If you don't specify a port, KeyPath's setup wizard will add TCP configuration automatically. If you use a custom port, update KeyPath's service configuration to match.

## KeyPath Limitations & Non-Goals

### What KeyPath Does NOT Do

1. **No config parsing/importing into UI**
   - KeyPath does not parse your Kanata config to populate the UI
   - The UI shows only rules created through KeyPath's interface
   - Your BYOC (Bring Your Own Config) rules are invisible to the UI

2. **UI may not reflect BYOC rules**
   - The overlay/mapper views may show limited or approximate data
   - KeyPath uses TCP + simulator to understand config state, not parsing
   - Complex aliases or macros may not display correctly in the UI

3. **KeyPath-managed sections may be regenerated**
   - If you use KeyPath's UI, managed sections (marked with `;; === KEYPATH MANAGED ===`) are overwritten on save
   - Your custom sections (outside managed blocks) are always preserved
   - See [ADR-025](/adr/adr-025-config-management) for details

4. **No config translation**
   - KeyPath does not convert your Kanata config into UI rules
   - You can't "import" existing remappings into KeyPath's visual editor
   - Use KeyPath's UI for new rules, keep existing rules in your config file

### What Still Works with BYOC

Even with a BYOC setup, KeyPath still provides:

- ✅ **Service management** - Automatic LaunchDaemon setup and monitoring
- ✅ **Permission handling** - Guided wizard for Input Monitoring and Accessibility
- ✅ **Driver management** - Automatic Karabiner VirtualHID driver installation
- ✅ **Hot reload** - Changes to your config file are detected and reloaded via TCP
- ✅ **Conflict detection** - Detects and resolves conflicts with other remappers
- ✅ **Health monitoring** - Service status checks and automatic recovery
- ✅ **Emergency stop** - `Ctrl + Space + Esc` to disable all remappings

### When You Might Hit Limitations

**You'll notice limitations if:**

- You expect KeyPath's UI to show your custom rules (it won't - BYOC rules are invisible to UI)
- You want to edit complex aliases/macros through the UI (use your text editor instead)
- You need KeyPath to understand your layer structure for the overlay (it uses TCP/simulator, which may miss edge cases)

**You won't notice limitations if:**

- You're happy editing your config file directly (KeyPath preserves it)
- You use KeyPath primarily for service management and permissions
- You add new simple remappings through KeyPath's UI while keeping complex rules in your config

## Troubleshooting

### Config Not Loading?

1. **Check TCP is enabled** - KeyPath needs TCP for validation
2. **Verify include path** - `keypath-apps.kbd` must be in the same directory
3. **Check logs** - `tail -f /var/log/com.keypath.kanata.stdout.log`
4. **Run setup wizard** - File → Run Setup Wizard to check for issues

### KeyPath Overwrites My Config?

KeyPath only overwrites sections marked with `;; === KEYPATH MANAGED ===`. Your custom sections are preserved. If you see unexpected changes:

1. Check if you're editing in a managed section
2. Use KeyPath's UI for new rules, edit your config file for custom rules
3. See [ADR-025](/adr/adr-025-config-management) for the preservation model

### TCP Port Conflicts?

If you use a custom TCP port:

1. Update your `defcfg` to match KeyPath's service configuration
2. Or let KeyPath use the default port (37001) and update your config
3. Run the setup wizard to synchronize TCP settings

### Service Not Starting?

1. **Check permissions** - Run setup wizard to verify Input Monitoring and Accessibility
2. **Check conflicts** - Wizard detects conflicting processes (Karabiner, orphaned Kanata)
3. **Check logs** - View system logs for error messages
4. **Use Fix button** - Wizard's Fix button resolves most issues automatically

## Advanced: Using Symlinks

If you prefer to keep your config in a dotfiles repository or custom location, you can use a symlink:

```bash
# Create KeyPath's config directory
mkdir -p ~/.config/keypath

# Create symlink to your existing config
ln -s ~/.config/kanata/my-config.kbd ~/.config/keypath/keypath.kbd
```

**Important:** Ensure `keypath-apps.kbd` is accessible at the symlink location (same directory). KeyPath generates it in `~/.config/keypath/`, so if your symlink points elsewhere, the include may fail.

**Recommendation:** Use KeyPath's wizard "symlink" option (if available) or copy your config instead of symlinking to avoid path resolution issues.

## Next Steps

- **Read the [Architecture Overview](/architecture/overview)** - Understand how KeyPath works
- **Check [ADR-027](/adr/adr-027-app-specific-keymaps)** - Details on the two-file model
- **See [ADR-023](/adr/adr-023-no-config-parsing)** - Why KeyPath doesn't parse configs
- **Review [ADR-025](/adr/adr-025-config-management)** - How config preservation works

## Getting Help

- **GitHub Issues**: [Report bugs or ask questions]({{ site.github_url }}/issues)
- **FAQ**: [Frequently asked questions](/faq)
- **Debugging Guide**: [Advanced troubleshooting](/guides/debugging)
