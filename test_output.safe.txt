Test Suite 'All tests' started at 2025-11-22 12:49:31.847.
Test Suite 'KeyPathPackageTests.xctest' started at 2025-11-22 12:49:31.849.
Test Suite 'AuthorizationServicesSmokeTests' started at 2025-11-22 12:49:31.849.
Test Case '-[KeyPathTests.AuthorizationServicesSmokeTests testAuthorizationServicesInstallationCreatesPlistsAndBootstraps]' started.
[2025-11-22 12:49:31.852] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/auth-smoke-67882F0D-87D2-4197-975A-682EBE2F6A60/Users/malpern/.config/keypath
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/auth-smoke-67882F0D-87D2-4197-975A-682EBE2F6A60/Users/malpern/.config/keypath/keypath.kbd
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:31.853] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:31.853] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/auth-smoke-67882F0D-87D2-4197-975A-682EBE2F6A60/Users/malpern/.config/keypath/keypath.kbd
[2025-11-22 12:49:31.853] [INFO] [LaunchDaemonInstaller.swift:229 getKanataBinaryPath()] âš ï¸ [LaunchDaemon] System kanata not found, using bundled path: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/auth-smoke-67882F0D-87D2-4197-975A-682EBE2F6A60/bundled-kanata
[2025-11-22 12:49:31.854] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:31.854] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/auth-smoke-67882F0D-87D2-4197-975A-682EBE2F6A60/bundled-kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/auth-smoke-67882F0D-87D2-4197-975A-682EBE2F6A60/Users/malpern/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:31.854] [INFO] [LaunchDaemonInstaller.swift:1214 executeConsolidatedInstallationWithAuthServices(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Starting consolidated installation with Authorization Services
[2025-11-22 12:49:31.854] [INFO] [LaunchDaemonInstaller.swift:1216 executeConsolidatedInstallationWithAuthServices(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] This approach bypasses osascript sandbox restrictions
[2025-11-22 12:49:32.323] [INFO] [LaunchDaemonInstaller.swift:1322 executeConsolidatedInstallationWithAuthServices(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] Authorization Services installation completed successfully
Test Case '-[KeyPathTests.AuthorizationServicesSmokeTests testAuthorizationServicesInstallationCreatesPlistsAndBootstraps]' passed (0.477 seconds).
Test Suite 'AuthorizationServicesSmokeTests' passed at 2025-11-22 12:49:32.325.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.477 (0.477) seconds
Test Suite 'ConfigApplyTypesTests' started at 2025-11-22 12:49:32.325.
Test Case '-[KeyPathTests.ConfigApplyTypesTests testApplyResultInitConvenience]' started.
Test Case '-[KeyPathTests.ConfigApplyTypesTests testApplyResultInitConvenience]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigApplyTypesTests testConfigDiagnosticsInit]' started.
Test Case '-[KeyPathTests.ConfigApplyTypesTests testConfigDiagnosticsInit]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigApplyTypesTests testConfigEditCommandEquatable]' started.
Test Case '-[KeyPathTests.ConfigApplyTypesTests testConfigEditCommandEquatable]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigApplyTypesTests testConfigErrorEquality]' started.
Test Case '-[KeyPathTests.ConfigApplyTypesTests testConfigErrorEquality]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigApplyTypesTests testFeatureFlagDefaultsOff]' started.
Test Case '-[KeyPathTests.ConfigApplyTypesTests testFeatureFlagDefaultsOff]' passed (0.000 seconds).
Test Suite 'ConfigApplyTypesTests' passed at 2025-11-22 12:49:32.326.
	 Executed 5 tests, with 0 failures (0 unexpected) in 0.000 (0.001) seconds
Test Suite 'ConfigFileWatcherTests' started at 2025-11-22 12:49:32.326.
Test Case '-[KeyPathTests.ConfigFileWatcherTests testDebouncePreventsMultipleCallbacks]' started.
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:80 startWatching(path:onChange:)] ğŸ“ [FileWatcher] Starting to watch file: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:81 startWatching(path:onChange:)] ğŸ“ [FileWatcher] Parent directory: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:85 startWatching(path:onChange:)] ğŸ“ [FileWatcher] Target file exists - setting up direct file monitoring
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:434 updateLastModificationDate()] ğŸ“ [FileWatcher] Updated last modification date: 2025-11-22 20:49:32 +0000
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:414 openFileDescriptor(at:)] ğŸ“ [FileWatcher] Successfully opened file descriptor 5 for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:114 setupFileMonitoring()] ğŸ“ [FileWatcher] Successfully opened file descriptor 5 for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:146 setupFileMonitoring()] âœ… [FileWatcher] Successfully started file monitoring for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:129 setupFileMonitoring()] ğŸ“ [FileWatcher] File system event received - flags: FileSystemEvent(rawValue: 1)
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:270 handleFileEvent(flags:)] ğŸ“ [FileWatcher] Detected atomic write (rename/delete) - rebinding file descriptor
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:282 rebindFileMonitor(to:)] ğŸ”„ [FileWatcher] Rebinding file monitor to: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:331 handleFileChangeEvent()] ğŸ“ [FileWatcher] Processing file change event for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.327] [INFO] [ConfigFileWatcher.swift:137 setupFileMonitoring()] ğŸ“ [FileWatcher] Closing file descriptor 5
[2025-11-22 12:49:32.381] [INFO] [ConfigFileWatcher.swift:434 updateLastModificationDate()] ğŸ“ [FileWatcher] Updated last modification date: 2025-11-22 20:49:32 +0000
[2025-11-22 12:49:32.381] [INFO] [ConfigFileWatcher.swift:414 openFileDescriptor(at:)] ğŸ“ [FileWatcher] Successfully opened file descriptor 5 for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.381] [INFO] [ConfigFileWatcher.swift:114 setupFileMonitoring()] ğŸ“ [FileWatcher] Successfully opened file descriptor 5 for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.382] [INFO] [ConfigFileWatcher.swift:146 setupFileMonitoring()] âœ… [FileWatcher] Successfully started file monitoring for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:489 processFileChange()] ğŸ“ [FileWatcher] Processing debounced file change for: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/C344F7B5-8AFA-4FB1-8A79-FA3CB43289F6/config.kbd
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:505 processFileChange()] ğŸ“ [FileWatcher] Atomic write detected - forcing change callback
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:518 processFileChange()] ğŸ“ [FileWatcher] Triggering file change callback for file (5 bytes)
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:529 processFileChange()] âœ… [FileWatcher] File change callback completed
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:208 stopWatching()] ğŸ“ [FileWatcher] Stopping all monitoring...
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:216 stopWatching()] ğŸ“ [FileWatcher] Stopping file monitoring
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:237 stopWatching()] âœ… [FileWatcher] All monitoring stopped and state cleared
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:137 setupFileMonitoring()] ğŸ“ [FileWatcher] Closing file descriptor 5
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:208 stopWatching()] ğŸ“ [FileWatcher] Stopping all monitoring...
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:237 stopWatching()] âœ… [FileWatcher] All monitoring stopped and state cleared
[2025-11-22 12:49:32.847] [INFO] [ConfigFileWatcher.swift:45 deinit] ğŸ“ [FileWatcher] ConfigFileWatcher deinitialized
Test Case '-[KeyPathTests.ConfigFileWatcherTests testDebouncePreventsMultipleCallbacks]' passed (0.521 seconds).
Test Suite 'ConfigFileWatcherTests' passed at 2025-11-22 12:49:32.847.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.521 (0.521) seconds
Test Suite 'ConfigurationServiceTests' started at 2025-11-22 12:49:32.847.
Test Case '-[KeyPathTests.ConfigurationServiceTests testBackupFailedConfigAndApplySafe]' started.
[2025-11-22 12:49:32.847] [INFO] [ConfigurationService.swift:757 backupFailedConfigAndApplySafe(failedConfig:mappings:)] ğŸ›¡ï¸ [Config] Backing up failed config and applying safe default
[2025-11-22 12:49:32.848] [INFO] [ConfigurationService.swift:782 backupFailedConfigAndApplySafe(failedConfig:mappings:)] ğŸ’¾ [Config] Failed config backed up to: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_8E7B19E5-2821-4F84-8BE3-7F97A6BBE077/backups/failed_config_2025-11-22_12-49-32.kbd
[2025-11-22 12:49:32.848] [INFO] [ConfigurationService.swift:790 backupFailedConfigAndApplySafe(failedConfig:mappings:)] âœ… [Config] Safe default config applied
Test Case '-[KeyPathTests.ConfigurationServiceTests testBackupFailedConfigAndApplySafe]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testBackupFailedConfigAppliesSafeDefaults]' started.
[2025-11-22 12:49:32.849] [INFO] [ConfigurationService.swift:757 backupFailedConfigAndApplySafe(failedConfig:mappings:)] ğŸ›¡ï¸ [Config] Backing up failed config and applying safe default
[2025-11-22 12:49:32.849] [INFO] [ConfigurationService.swift:782 backupFailedConfigAndApplySafe(failedConfig:mappings:)] ğŸ’¾ [Config] Failed config backed up to: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_AD4BEB2B-BCB8-4E8E-B5D7-F9A92D9C0B8C/backups/failed_config_2025-11-22_12-49-32.kbd
[2025-11-22 12:49:32.850] [INFO] [ConfigurationService.swift:790 backupFailedConfigAndApplySafe(failedConfig:mappings:)] âœ… [Config] Safe default config applied
Test Case '-[KeyPathTests.ConfigurationServiceTests testBackupFailedConfigAppliesSafeDefaults]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataKey_CaseInsensitive]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataKey_CaseInsensitive]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataKey_ModifierKeys]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataKey_ModifierKeys]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataKey_StandardKeys]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataKey_StandardKeys]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_KeyNameNotMacro]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_KeyNameNotMacro]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_MultipleKeys]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_MultipleKeys]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_SingleKey]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_SingleKey]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_SingleKeyVariants]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_SingleKeyVariants]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_SingleLongKey]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_SingleLongKey]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_TextMacro_Letters]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_TextMacro_Letters]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_TextMacro_Numbers]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testConvertToKanataSequence_TextMacro_Numbers]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testCreateInitialConfigWritesDefaultFile]' started.
[2025-11-22 12:49:32.851] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_D7111842-3DC6-4956-922E-44A83C68B6D9
[2025-11-22 12:49:32.851] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_D7111842-3DC6-4956-922E-44A83C68B6D9/keypath.kbd
[2025-11-22 12:49:32.851] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.851] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.851] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:32.851] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.852] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:32.852] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.852] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.852] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:32.852] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
Test Case '-[KeyPathTests.ConfigurationServiceTests testCreateInitialConfigWritesDefaultFile]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testDisablingMacFunctionKeysRemovesSpecialMappings]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testDisablingMacFunctionKeysRemovesSpecialMappings]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testGeneratedConfigHasNoInvalidParentheses]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testGeneratedConfigHasNoInvalidParentheses]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testGeneratedConfigWithTextMacro]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testGeneratedConfigWithTextMacro]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_EmptyMappings]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_EmptyMappings]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_MultipleMappings]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_MultipleMappings]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_SingleMapping]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_SingleMapping]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_UsesSingleDefsrcAndDeflayer]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testGenerateFromMappings_UsesSingleDefsrcAndDeflayer]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testNavigationCollectionProducesSeparateLayerAndAlias]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testNavigationCollectionProducesSeparateLayerAndAlias]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testObserverFiresOnMainActor_OnReload]' started.
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 0 src keys, 0 layer keys, deduplicated to 0 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testObserverFiresOnMainActor_OnReload]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testObserverFiresOnMainActor_OnSave]' started.
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 1068 characters
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 11 src keys, 11 layer keys, deduplicated to 11 unique mappings
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.855] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.856] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 1 mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testObserverFiresOnMainActor_OnSave]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseConfigurationFromString_Deduplication]' started.
[2025-11-22 12:49:32.856] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 3 src keys, 3 layer keys, deduplicated to 2 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseConfigurationFromString_Deduplication]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseConfigurationFromString_ValidConfig]' started.
[2025-11-22 12:49:32.857] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 3 src keys, 3 layer keys, deduplicated to 3 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseConfigurationFromString_ValidConfig]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseConfigurationFromString_WithComments]' started.
[2025-11-22 12:49:32.857] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 1 src keys, 1 layer keys, deduplicated to 1 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseConfigurationFromString_WithComments]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseKanataErrors_EmptyOutput]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseKanataErrors_EmptyOutput]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseKanataErrors_NoErrorTags]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseKanataErrors_NoErrorTags]' passed (0.003 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseKanataErrors_WithErrorTags]' started.
Test Case '-[KeyPathTests.ConfigurationServiceTests testParseKanataErrors_WithErrorTags]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testReloadCreatesDefaultConfigWhenMissing]' started.
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:385 reload()] âš ï¸ [ConfigService] Config missing at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_24C79D92-CA5D-4D34-AAC6-1A29F0F4D43C/keypath.kbd â€“ creating default before reload
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_24C79D92-CA5D-4D34-AAC6-1A29F0F4D43C
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/KeyPathConfigTests_24C79D92-CA5D-4D34-AAC6-1A29F0F4D43C/keypath.kbd
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:32.862] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testReloadCreatesDefaultConfigWhenMissing]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testRepairConfiguration_MismatchedLengths]' started.
[2025-11-22 12:49:32.863] [INFO] [ConfigurationService.swift:808 repairConfiguration(config:errors:mappings:)] ğŸ”§ [Config] Performing rule-based repair for 1 errors
Test Case '-[KeyPathTests.ConfigurationServiceTests testRepairConfiguration_MismatchedLengths]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testRepairConfiguration_MissingDefcfg]' started.
[2025-11-22 12:49:32.863] [INFO] [ConfigurationService.swift:808 repairConfiguration(config:errors:mappings:)] ğŸ”§ [Config] Performing rule-based repair for 1 errors
Test Case '-[KeyPathTests.ConfigurationServiceTests testRepairConfiguration_MissingDefcfg]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testRoundTrip_GenerateParseGenerate]' started.
[2025-11-22 12:49:32.863] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 12 src keys, 12 layer keys, deduplicated to 12 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testRoundTrip_GenerateParseGenerate]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithCustomRules]' started.
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 1442 characters
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 11 src keys, 11 layer keys, deduplicated to 11 unique mappings
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.864] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 2 mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithCustomRules]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithInputOutput]' started.
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 1063 characters
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 11 src keys, 11 layer keys, deduplicated to 11 unique mappings
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 1 mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithInputOutput]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithKeyMappings]' started.
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 1068 characters
[2025-11-22 12:49:32.865] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 11 src keys, 11 layer keys, deduplicated to 11 unique mappings
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 1 mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithKeyMappings]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithRuleCollections]' started.
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 1166 characters
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 11 src keys, 11 layer keys, deduplicated to 11 unique mappings
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.866] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 1 mappings
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 11 src keys, 11 layer keys, deduplicated to 11 unique mappings
Test Case '-[KeyPathTests.ConfigurationServiceTests testSaveConfiguration_WithRuleCollections]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testValidateConfigurationInTestModePasses]' started.
[2025-11-22 12:49:32.867] [INFO] [TestEnvironment.swift:82 forceTestMode] ğŸ§ª [TestEnvironment] Force test mode enabled
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 79 characters
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 1 src keys, 1 layer keys, deduplicated to 1 unique mappings
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
Test Case '-[KeyPathTests.ConfigurationServiceTests testValidateConfigurationInTestModePasses]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testValidateConfigurationInTestModeRejectsEmptyContent]' started.
[2025-11-22 12:49:32.867] [INFO] [TestEnvironment.swift:82 forceTestMode] ğŸ§ª [TestEnvironment] Force test mode enabled
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3 characters
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
Test Case '-[KeyPathTests.ConfigurationServiceTests testValidateConfigurationInTestModeRejectsEmptyContent]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ConfigurationServiceTests testValidateConfigViaFileSkipsBinaryInTestMode]' started.
[2025-11-22 12:49:32.867] [INFO] [TestEnvironment.swift:82 forceTestMode] ğŸ§ª [TestEnvironment] Force test mode enabled
[2025-11-22 12:49:32.867] [INFO] [ConfigurationService.swift:566 validateConfigViaFile()] âŒ [ConfigService] File validation skipped: Kanata binary missing at /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
Test Case '-[KeyPathTests.ConfigurationServiceTests testValidateConfigViaFileSkipsBinaryInTestMode]' passed (0.000 seconds).
Test Suite 'ConfigurationServiceTests' passed at 2025-11-22 12:49:32.868.
	 Executed 40 tests, with 0 failures (0 unexpected) in 0.018 (0.020) seconds
Test Suite 'ContentViewDebounceTests' started at 2025-11-22 12:49:32.868.
Test Case '-[KeyPathTests.ContentViewDebounceTests testConfigurationSaveDebouncing]' started.
[2025-11-22 12:49:32.868] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:32.868] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.868] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.868] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:32.868] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:32.868] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:32.868] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:32.868] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:32.868] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:32.868] [INFO] [ContentViewDebounceTests.swift:38 testConfigurationSaveDebouncing()] âœ… [Test] Configuration debouncing behavior verified
Test Case '-[KeyPathTests.ContentViewDebounceTests testConfigurationSaveDebouncing]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ContentViewDebounceTests testConfigurationSaveFlow]' started.
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:32.869] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.869] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.869] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:32.869] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:32.869] [INFO] [ContentViewDebounceTests.swift:81 testConfigurationSaveFlow()] âœ… [Test] Configuration save flow structure verified
Test Case '-[KeyPathTests.ContentViewDebounceTests testConfigurationSaveFlow]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ContentViewDebounceTests testErrorHandlingPreservesUIState]' started.
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:32.869] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.869] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.869] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:32.869] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:32.869] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:32.869] [INFO] [ContentViewDebounceTests.swift:53 testErrorHandlingPreservesUIState()] âœ… [Test] Error handling structure verified
Test Case '-[KeyPathTests.ContentViewDebounceTests testErrorHandlingPreservesUIState]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ContentViewDebounceTests testMultipleConcurrentSaves]' started.
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:32.870] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.870] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.870] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:32.870] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:91 testMultipleConcurrentSaves()] ğŸ§ª [Test] Starting concurrent save task 1
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:99 testMultipleConcurrentSaves()] ğŸ§ª [Test] Completed concurrent save task 1
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:91 testMultipleConcurrentSaves()] ğŸ§ª [Test] Starting concurrent save task 2
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:99 testMultipleConcurrentSaves()] ğŸ§ª [Test] Completed concurrent save task 2
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:91 testMultipleConcurrentSaves()] ğŸ§ª [Test] Starting concurrent save task 3
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:99 testMultipleConcurrentSaves()] ğŸ§ª [Test] Completed concurrent save task 3
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.870] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.870] [INFO] [ContentViewDebounceTests.swift:108 testMultipleConcurrentSaves()] âœ… [Test] Concurrent saves handled successfully
Test Case '-[KeyPathTests.ContentViewDebounceTests testMultipleConcurrentSaves]' passed (0.001 seconds).
Test Suite 'ContentViewDebounceTests' passed at 2025-11-22 12:49:32.870.
	 Executed 4 tests, with 0 failures (0 unexpected) in 0.002 (0.003) seconds
Test Suite 'CustomRulesStoreTests' started at 2025-11-22 12:49:32.870.
Test Case '-[KeyPathTests.CustomRulesStoreTests testLoadGracefullyHandlesCorruptData]' started.
[2025-11-22 12:49:32.871] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.871] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.871] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:32.871] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:32.871] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:32.871] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:32.871] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:32.871] [INFO] [ConfigFileWatcher.swift:208 stopWatching()] ğŸ“ [FileWatcher] Stopping all monitoring...
[2025-11-22 12:49:32.871] [INFO] [ConfigFileWatcher.swift:237 stopWatching()] âœ… [FileWatcher] All monitoring stopped and state cleared
[2025-11-22 12:49:32.871] [INFO] [ConfigFileWatcher.swift:45 deinit] ğŸ“ [FileWatcher] ConfigFileWatcher deinitialized
[2025-11-22 12:49:32.871] [INFO] [LayerChangeListener.swift:27 stop()] ğŸŒ [LayerListener] Stopping layer listener
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:32.872] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:32.872] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:32.872] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:32.872] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:32.872] [INFO] [ConfigFileWatcher.swift:208 stopWatching()] ğŸ“ [FileWatcher] Stopping all monitoring...
[2025-11-22 12:49:32.872] [INFO] [ConfigFileWatcher.swift:237 stopWatching()] âœ… [FileWatcher] All monitoring stopped and state cleared
[2025-11-22 12:49:32.872] [INFO] [ConfigFileWatcher.swift:45 deinit] ğŸ“ [FileWatcher] ConfigFileWatcher deinitialized
[2025-11-22 12:49:32.872] [INFO] [LayerChangeListener.swift:27 stop()] ğŸŒ [LayerListener] Stopping layer listener
[2025-11-22 12:49:32.872] [INFO] [CustomRulesStore.swift:35 loadRules()] âš ï¸ [CustomRulesStore] Failed to load rules: dataCorrupted(Swift.DecodingError.Context(codingPath: [], debugDescription: "The given data was not valid JSON.", underlyingError: Optional(Error Domain=NSCocoaErrorDomain Code=3840 "Unexpected character 'o' in expected null value around line 1, column 2." UserInfo={NSDebugDescription=Unexpected character 'o' in expected null value around line 1, column 2., NSJSONSerializationErrorIndex=1})))
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
Test Case '-[KeyPathTests.CustomRulesStoreTests testLoadGracefullyHandlesCorruptData]' passed (0.002 seconds).
Test Case '-[KeyPathTests.CustomRulesStoreTests testLoadReturnsEmptyWhenFileMissing]' started.
[2025-11-22 12:49:32.872] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:32.872] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:32.873] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:32.873] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:32.873] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:32.873] [INFO] [ConfigFileWatcher.swift:208 stopWatching()] ğŸ“ [FileWatcher] Stopping all monitoring...
[2025-11-22 12:49:32.873] [INFO] [ConfigFileWatcher.swift:237 stopWatching()] âœ… [FileWatcher] All monitoring stopped and state cleared
[2025-11-22 12:49:32.873] [INFO] [ConfigFileWatcher.swift:45 deinit] ğŸ“ [FileWatcher] ConfigFileWatcher deinitialized
[2025-11-22 12:49:32.873] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:32.873] [INFO] [LayerChangeListener.swift:27 stop()] ğŸŒ [LayerListener] Stopping layer listener
[2025-11-22 12:49:32.873] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:32.873] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:32.873] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:32.873] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:32.873] [INFO] [ConfigFileWatcher.swift:208 stopWatching()] ğŸ“ [FileWatcher] Stopping all monitoring...
[2025-11-22 12:49:32.873] [INFO] [ConfigFileWatcher.swift:237 stopWatching()] âœ… [FileWatcher] All monitoring stopped and state cleared
[2025-11-22 12:49:32.873] [INFO] [LayerChangeListener.swift:27 stop()] ğŸŒ [LayerListener] Stopping layer listener
[2025-11-22 12:49:32.873] [INFO] [ConfigFileWatcher.swift:45 deinit] ğŸ“ [FileWatcher] ConfigFileWatcher deinitialized
Test Case '-[KeyPathTests.CustomRulesStoreTests testLoadReturnsEmptyWhenFileMissing]' passed (0.000 seconds).
Test Case '-[KeyPathTests.CustomRulesStoreTests testSaveAndLoadRoundTrip]' started.
Test Case '-[KeyPathTests.CustomRulesStoreTests testSaveAndLoadRoundTrip]' passed (0.001 seconds).
Test Suite 'CustomRulesStoreTests' passed at 2025-11-22 12:49:32.874.
	 Executed 3 tests, with 0 failures (0 unexpected) in 0.004 (0.004) seconds
Test Suite 'DiagnosticsServiceTests' started at 2025-11-22 12:49:32.874.
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileNotFound]' started.
[2025-11-22 12:49:32.874] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileNotFound]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithCleanLogs]' started.
[2025-11-22 12:49:32.875] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithCleanLogs]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithConnectionError]' started.
[2025-11-22 12:49:32.875] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithConnectionError]' passed (0.001 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithGenericError]' started.
[2025-11-22 12:49:32.875] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithGenericError]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithPermissionError]' started.
[2025-11-22 12:49:32.876] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testAnalyzeLogFileWithPermissionError]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testCheckProcessConflictsReturnsNonNilResult]' started.
[2025-11-22 12:49:32.876] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.876] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:49:32.876] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
Test Case '-[KeyPathTests.DiagnosticsServiceTests testCheckProcessConflictsReturnsNonNilResult]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseConfigurationError]' started.
[2025-11-22 12:49:32.876] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseConfigurationError]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseDeviceConflict]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseDeviceConflict]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseGenericExitCode6]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseGenericExitCode6]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosePermissionError]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosePermissionError]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosePermissionRelatedUnknownExitCode]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosePermissionRelatedUnknownExitCode]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseSIGKILL]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseSIGKILL]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseSIGTERM]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseSIGTERM]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseUnknownExitCode]' started.
[2025-11-22 12:49:32.877] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseUnknownExitCode]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseVirtualHIDConnectionFailure]' started.
[2025-11-22 12:49:32.878] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnoseVirtualHIDConnectionFailure]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosticCategoryRawValues]' started.
[2025-11-22 12:49:32.878] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosticCategoryRawValues]' passed (0.000 seconds).
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosticSeverityEmojis]' started.
[2025-11-22 12:49:32.878] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
Test Case '-[KeyPathTests.DiagnosticsServiceTests testDiagnosticSeverityEmojis]' passed (0.000 seconds).
Test Suite 'DiagnosticsServiceTests' passed at 2025-11-22 12:49:32.878.
	 Executed 17 tests, with 0 failures (0 unexpected) in 0.003 (0.004) seconds
Test Suite 'ErrorHandlingTests' started at 2025-11-22 12:49:32.878.
Test Case '-[KeyPathTests.ErrorHandlingTests testAsyncConfigurationErrors]' started.
[2025-11-22 12:49:32.878] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:32.878] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.878] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.878] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:32.878] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:32.878] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:32.878] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:32.878] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:32.878] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:32.878] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
Test Case '-[KeyPathTests.ErrorHandlingTests testAsyncConfigurationErrors]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testAsyncResetConfigurationErrors]' started.
[2025-11-22 12:49:32.878] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:32.878] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.878] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:32.878] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:32.878] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:32.879] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:32.879] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:32.879] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:32.879] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:32.879] [INFO] [KanataManager.swift:2188 resetToDefaultConfig()] ğŸ”„ [Reset] Forcing reset to default config (no validation - recovery mode)
[2025-11-22 12:49:32.879] [INFO] [ConfigBackupManager.swift:61 createPreEditBackup()] âœ… [BackupManager] Created pre-edit backup: keypath_2025-11-22_20-49-32.kbd
[2025-11-22 12:49:32.880] [INFO] [ConfigBackupManager.swift:190 cleanupOldBackups()] ğŸ—‘ï¸ [BackupManager] Deleted old backup: keypath_2025-11-22_16-04-21.kbd
[2025-11-22 12:49:32.880] [INFO] [KanataManager.swift:2194 resetToDefaultConfig()] ğŸ’¾ [Reset] Safety backup created before default reset
[2025-11-22 12:49:32.881] [INFO] [KanataManager.swift:2211 resetToDefaultConfig()] ğŸ’¾ [Config] Reset to default configuration (macOS Function Keys only)
[2025-11-22 12:49:32.881] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.881] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.881] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.881] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.881] [INFO] [KanataManager.swift:2225 resetToDefaultConfig()] ğŸ”„ [Reset] Updated stores and manager properties to match default state
[2025-11-22 12:49:32.881] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:32.881] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:49:32.881] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:49:32.881] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:49:32.881] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:49:32.881] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844572.881
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:32.882] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:32.882] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.882] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:49:32.882] [INFO] [HelperManager.swift:64 init()] ğŸ”§ [HelperManager] Initialized
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:49:32.882] [INFO] [PermissionOracle.swift:135 init()] ğŸ”® [Oracle] Permission Oracle initialized - ending the chaos!
[2025-11-22 12:49:32.882] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:49:32.882] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:49:32.882] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:49:32.882] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 0.001s
[2025-11-22 12:49:32.882] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:49:32.882] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:49:32.882] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:49:32.886] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:49:32.888] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:49:32.905] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:49:32.905] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:49:32.905] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:49:32.905] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:49:32.906] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:49:32.909] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:49:32.909] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:49:32.911] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:32.948] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.066s)
[2025-11-22 12:49:32.948] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:49:33.522] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:49:33.522] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:49:33.522] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:49:33.522] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:49:33.523] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:49:33.523] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:33.590] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:49:33.591] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:33.591] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:33.591] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:49:33.591] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:33.592] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:33.592] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:33.592] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:49:33.592] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:33.592] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:49:33.592] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:49:33.592] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:33.660] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:49:33.727] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:49:33.794] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:49:33.794] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:33.862] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:49:33.862] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:33.929] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:49:33.930] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:49:33.930] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.048s
[2025-11-22 12:49:33.930] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:49:33.930] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:49:33.930] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:33.997] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:49:33.997] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:34.065] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:49:34.132] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:49:34.132] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:49:34.705] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:49:34.705] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:49:34.705] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:49:34.705] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:49:34.705] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.824s
[2025-11-22 12:49:34.705] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:49:34.705] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=1.823s
[2025-11-22 12:49:34.705] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.824s
[2025-11-22 12:49:34.705] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:49:34.705] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:34.705] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:34.705] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:34.705] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:34.705] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:34.706] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:34.706] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:34.706] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:34.706] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:34.707] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:34.707] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:34.707] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:34.707] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:34.707] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:34.707] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:34.707] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:34.707] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:35.981] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:49:35.981] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:35.981] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:49:35.981] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.100s
[2025-11-22 12:49:35.981] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:49:35.981] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.100s
[2025-11-22 12:49:35.981] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.100s
[2025-11-22 12:49:35.981] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:49:35.981] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:35.981] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:35.982] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:49:35.982] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:35.982] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:49:35.982] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:49:35.982] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:35.982] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:35.982] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
Test Case '-[KeyPathTests.ErrorHandlingTests testAsyncResetConfigurationErrors]' passed (3.104 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testCommandKeyMappingErrorHandling]' started.
[2025-11-22 12:49:35.982] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:35.983] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:35.983] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:35.983] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:35.983] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:35.983] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:35.983] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:35.983] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:35.983] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
Test Case '-[KeyPathTests.ErrorHandlingTests testCommandKeyMappingErrorHandling]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testConcurrentConfigurationOperations]' started.
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:35.984] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:35.984] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:35.984] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.984] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.985] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.985] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.985] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.985] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:35.985] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:35.985] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:35.986] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.986] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.986] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 705 characters
[2025-11-22 12:49:35.986] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.987] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 8 src keys, 8 layer keys, deduplicated to 8 unique mappings
[2025-11-22 12:49:35.987] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.987] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.987] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 8 mappings
[2025-11-22 12:49:35.987] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:35.987] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.987] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:35.987] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.988] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.989] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.989] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.989] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.989] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.990] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.991] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.991] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:35.991] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.991] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:35.991] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.992] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.992] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.992] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.992] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.992] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.993] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.993] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.993] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.993] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.993] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.993] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.994] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.994] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.995] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.995] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.995] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.995] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.995] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.995] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.995] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.995] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.995] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.996] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.996] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:35.996] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.997] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.997] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.997] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.997] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.997] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.997] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:35.998] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:35.998] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:35.998] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.998] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.998] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.998] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.998] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.998] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.998] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:35.999] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:35.999] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.999] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.999] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.999] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.999] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.999] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.999] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.999] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.999] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.999] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.999] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.999] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.999] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:35.999] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:35.999] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:35.999] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:35.999] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:35.999] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:35.999] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:35.999] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:35.999] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.000] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:36.000] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.000] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:36.000] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:36.000] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:36.000] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.000] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:36.000] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.000] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:36.000] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:36.000] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.000] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
Test Case '-[KeyPathTests.ErrorHandlingTests testConcurrentConfigurationOperations]' passed (0.017 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigGenerationWithInvalidInputOutput]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigGenerationWithInvalidInputOutput]' passed (0.002 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigurationIntegrity]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigurationIntegrity]' passed (0.012 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigurationRoundTrip]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigurationRoundTrip]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigWithNonASCIICharacters]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigWithNonASCIICharacters]' passed (0.007 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigWithSpecialKanataCharacters]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testConfigWithSpecialKanataCharacters]' passed (0.002 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testDirectoryCreationErrorHandling]' started.
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.025] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.025] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.025] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.025] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:36.025] [INFO] [ConfigFileWatcher.swift:54 suppressEvents(for:reason:)] ğŸ”‡ [FileWatcher] Suppressing events for 1.0s - Internal saveConfiguration
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:818 backupCurrentConfig()] ğŸ’¾ [Backup] Current config backed up successfully
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.025] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.026] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.027] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.027] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.027] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.027] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.027] [DEBUG] [KanataManager.swift:1302 saveConfiguration(input:output:)] ğŸ“¡ [Config] Triggering TCP reload for validation
[2025-11-22 12:49:36.027] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.027] [ERROR] [KanataManager.swift:1318 saveConfiguration(input:output:)] âŒ [Config] TCP reload FAILED: Test environment - TCP disabled
[2025-11-22 12:49:36.027] [ERROR] [KanataManager.swift:1319 saveConfiguration(input:output:)] âŒ [Config] TCP server is required for validation-on-demand - restoring backup
[2025-11-22 12:49:36.027] [INFO] [KanataManager.swift:831 restoreLastGoodConfig()] ğŸ”„ [Restore] Restored last good config successfully
[2025-11-22 12:49:36.027] [INFO] [SoundManager.swift:15 playTinkSound()] ğŸ§ª [Sound] Suppressed tink sound in test environment
[2025-11-22 12:49:36.027] [INFO] [SoundManager.swift:35 playErrorSound()] ğŸ§ª [Sound] Suppressed error beep in test environment
[2025-11-22 12:49:36.027] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.027] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.027] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.027] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.027] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
Test Case '-[KeyPathTests.ErrorHandlingTests testDirectoryCreationErrorHandling]' passed (0.003 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testExtremeKeyCodeHandling]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testExtremeKeyCodeHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testInvalidKeyInputHandling]' started.
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.028] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.028] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.028] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.028] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
Test Case '-[KeyPathTests.ErrorHandlingTests testInvalidKeyInputHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testInvalidPathHandling]' started.
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.028] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.028] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.028] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.028] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.028] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
Test Case '-[KeyPathTests.ErrorHandlingTests testInvalidPathHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testKanataProcessErrorHandling]' started.
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.029] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.029] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.029] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.029] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:36.029] [INFO] [ProcessManager.swift:198 checkLaunchDaemonStatus()] ğŸ” [ProcessManager] Checking LaunchDaemon service status...
[2025-11-22 12:49:36.029] [INFO] [ProcessManager.swift:202 checkLaunchDaemonStatus()] ğŸ§ª [ProcessManager] Skipping launchctl check - returning mock data
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:1442 performUpdateStatus()] ğŸ”„ [Status] LaunchDaemon service running - cleared stale diagnostics
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.029] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
Test Case '-[KeyPathTests.ErrorHandlingTests testKanataProcessErrorHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testMemoryPressureErrorHandling]' started.
Test Case '-[KeyPathTests.ErrorHandlingTests testMemoryPressureErrorHandling]' passed (0.018 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testNilAndOptionalHandling]' started.
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.047] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.047] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.047] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.047] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
Test Case '-[KeyPathTests.ErrorHandlingTests testNilAndOptionalHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testPermissionErrorHandling]' started.
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.047] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.047] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.047] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.047] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.047] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.047] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
Test Case '-[KeyPathTests.ErrorHandlingTests testPermissionErrorHandling]' passed (0.012 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testResourceCleanupErrorHandling]' started.
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:331 setupEventTap(at:)] ğŸ§ª [KeyboardCapture] Test environment detected â€“ skipping CGEvent tap setup
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
[2025-11-22 12:49:36.059] [DEBUG] [KeyboardCapture.swift:600 startEmergencyMonitoring(callback:)] ğŸ§ª [KeyboardCapture] Test environment â€“ skipping emergency monitoring tap
Test Case '-[KeyPathTests.ErrorHandlingTests testResourceCleanupErrorHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testSequenceGenerationErrorHandling]' started.
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.059] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.059] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.059] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.059] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
Test Case '-[KeyPathTests.ErrorHandlingTests testSequenceGenerationErrorHandling]' passed (0.000 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testServiceInstallationErrorHandling]' started.
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.059] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.059] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.059] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.059] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.059] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
[2025-11-22 12:49:36.059] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:49:36.059] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:49:36.060] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.060] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.060] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:49:36.060] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:36.060] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:49:36.060] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:49:36.060] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:49:36.060] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
Test Case '-[KeyPathTests.ErrorHandlingTests testServiceInstallationErrorHandling]' passed (0.001 seconds).
Test Case '-[KeyPathTests.ErrorHandlingTests testSpecialCharacterKeyMapping]' started.
[2025-11-22 12:49:36.060] [INFO] [KanataManager.swift:330 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() called
[2025-11-22 12:49:36.060] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:36.060] [INFO] [ConfigFileWatcher.swift:40 init()] ğŸ“ [FileWatcher] ConfigFileWatcher initialized with robust monitoring
[2025-11-22 12:49:36.060] [INFO] [ServiceHealthMonitor.swift:140 init(processLifecycle:)] [HealthMonitor] Initialized with process lifecycle manager
[2025-11-22 12:49:36.060] [DEBUG] [KanataManager.swift:402 init(engineClient:injectedConfigurationService:)] ğŸ§ª [KanataManager] Skipping background initialization in test environment
[2025-11-22 12:49:36.060] [INFO] [KanataManager.swift:410 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] About to call bootstrapRuleCollections and startLayerMonitoring
[2025-11-22 12:49:36.060] [INFO] [KanataManager.swift:579 startLayerMonitoring()] ğŸŒ [KanataManager] startLayerMonitoring() called
[2025-11-22 12:49:36.060] [INFO] [KanataManager.swift:581 startLayerMonitoring()] ğŸŒ [KanataManager] Skipping layer monitoring (test environment)
[2025-11-22 12:49:36.060] [INFO] [KanataManager.swift:414 init(engineClient:injectedConfigurationService:)] ğŸ—ï¸ [KanataManager] init() completed
Test Case '-[KeyPathTests.ErrorHandlingTests testSpecialCharacterKeyMapping]' passed (0.000 seconds).
Test Suite 'ErrorHandlingTests' passed at 2025-11-22 12:49:36.060.
	 Executed 21 tests, with 0 failures (0 unexpected) in 3.181 (3.182) seconds
Test Suite 'FDADetectionTests' started at 2025-11-22 12:49:36.060.
Test Case '-[KeyPathTests.FDADetectionTests testDetectionModalTiming]' started.
Test Case '-[KeyPathTests.FDADetectionTests testDetectionModalTiming]' passed (0.000 seconds).
Test Case '-[KeyPathTests.FDADetectionTests testFDACaching]' started.
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
Test Case '-[KeyPathTests.FDADetectionTests testFDACaching]' passed (0.001 seconds).
Test Case '-[KeyPathTests.FDADetectionTests testFDACheckPerformance]' started.
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.061] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.062] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.062] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [KanataManager.swift:605 updateActiveLayerName(_:)] ğŸ¯ [KanataManager] updateActiveLayerName: raw='base' normalized='base' display='Base' current='Base'
[2025-11-22 12:49:36.062] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.062] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.062] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.063] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.064] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.064] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.064] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.064] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.064] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.064] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.064] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.064] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 3827 characters
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.064] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 18 src keys, 88 layer keys, deduplicated to 18 unique mappings
[2025-11-22 12:49:36.065] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.065] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.065] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.065] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.065] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.065] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
[2025-11-22 12:49:36.065] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 18 mappings
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:53 triggerConfigReload()] ğŸ“¡ [Reload] Attempting TCP reload
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:84 triggerTCPReload()] ğŸ§ª [TCP Reload] Skipping TCP reload in test environment
[2025-11-22 12:49:36.065] [DEBUG] [KanataManager+Configuration.swift:65 triggerConfigReload()] ğŸ“¡ [Reload] TCP reload failed: Test environment - TCP disabled
[2025-11-22 12:49:36.065] [WARN] [KanataManager+Configuration.swift:68 triggerConfigReload()] âš ï¸ [Reload] Falling back to service restart
/Users/malpern/local-code/KeyPath/Tests/KeyPathTests/FDADetectionTests.swift:154: Test Case '-[KeyPathTests.FDADetectionTests testFDACheckPerformance]' measured [Time, seconds] average: 0.004, relative standard deviation: 268.318%, values: [0.036961, 0.000513, 0.000665, 0.000341, 0.000596, 0.000321, 0.000309, 0.000544, 0.000331, 0.000264], performanceMetricID:com.apple.XCTPerformanceMetric_WallClockTime, baselineName: "", baselineAverage: , polarity: prefers smaller, maxPercentRegression: 10.000%, maxPercentRelativeStandardDeviation: 10.000%, maxRegression: 0.100, maxStandardDeviation: 0.100
Test Case '-[KeyPathTests.FDADetectionTests testFDACheckPerformance]' passed (0.457 seconds).
Test Case '-[KeyPathTests.FDADetectionTests testFDADetectionWithoutAccess]' started.
Test Case '-[KeyPathTests.FDADetectionTests testFDADetectionWithoutAccess]' passed (0.001 seconds).
Test Case '-[KeyPathTests.FDADetectionTests testProtectedPathDetection]' started.
No FDA access to: /Users/malpern/Library/Mail
No FDA access to: /Users/malpern/Library/Messages
Has FDA access to: /Users/malpern/Library/Safari/Bookmarks.plist
Test Case '-[KeyPathTests.FDADetectionTests testProtectedPathDetection]' passed (0.000 seconds).
Test Case '-[KeyPathTests.FDADetectionTests testRestartTimingWindow]' started.
Test Case '-[KeyPathTests.FDADetectionTests testRestartTimingWindow]' passed (0.002 seconds).
Test Case '-[KeyPathTests.FDADetectionTests testWizardStatePreservation]' started.
Test Case '-[KeyPathTests.FDADetectionTests testWizardStatePreservation]' passed (0.000 seconds).
Test Suite 'FDADetectionTests' passed at 2025-11-22 12:49:36.521.
	 Executed 7 tests, with 0 failures (0 unexpected) in 0.461 (0.461) seconds
Test Suite 'HealthCheckServiceTests' started at 2025-11-22 12:49:36.521.
Test Case '-[KeyPathTests.HealthCheckServiceTests testEvaluate_Healthy_NoRestart]' started.
Test Case '-[KeyPathTests.HealthCheckServiceTests testEvaluate_Healthy_NoRestart]' passed (0.000 seconds).
Test Case '-[KeyPathTests.HealthCheckServiceTests testEvaluate_Unhealthy_ShouldRestart]' started.
Test Case '-[KeyPathTests.HealthCheckServiceTests testEvaluate_Unhealthy_ShouldRestart]' passed (0.000 seconds).
Test Suite 'HealthCheckServiceTests' passed at 2025-11-22 12:49:36.522.
	 Executed 2 tests, with 0 failures (0 unexpected) in 0.000 (0.000) seconds
Test Suite 'HelperMaintenanceTests' started at 2025-11-22 12:49:36.522.
Test Case '-[KeyPathTests.HelperMaintenanceTests testAdminCleanupFallbackFailureAbortsRun]' started.
[2025-11-22 12:49:36.523] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair started
[2025-11-22 12:49:36.526] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… App copy check: OK (/Applications/KeyPath.app)
[2025-11-22 12:49:36.526] [INFO] [HelperMaintenance.swift:298 log(_:)] âš ï¸ Primary registration failed; attempting cleanup then retry
[2025-11-22 12:49:36.527] [INFO] [HelperMaintenance.swift:298 log(_:)] âš ï¸ Admin cleanup failed (exit 1): Permission denied
[2025-11-22 12:49:36.527] [INFO] [HelperMaintenance.swift:298 log(_:)] âŒ Legacy helper cleanup failed; aborting repair
[2025-11-22 12:49:36.527] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair finished
Test Case '-[KeyPathTests.HelperMaintenanceTests testAdminCleanupFallbackFailureAbortsRun]' passed (0.006 seconds).
Test Case '-[KeyPathTests.HelperMaintenanceTests testAdminCleanupFallbackSucceedsWithExecutor]' started.
[2025-11-22 12:49:36.529] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair started
[2025-11-22 12:49:36.529] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… App copy check: OK (/Applications/KeyPath.app)
[2025-11-22 12:49:36.529] [INFO] [HelperMaintenance.swift:298 log(_:)] âš ï¸ Primary registration failed; attempting cleanup then retry
[2025-11-22 12:49:36.529] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Admin cleanup removed legacy helper artifacts
[2025-11-22 12:49:36.529] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper responding via XPC
[2025-11-22 12:49:36.529] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair finished
Test Case '-[KeyPathTests.HelperMaintenanceTests testAdminCleanupFallbackSucceedsWithExecutor]' passed (0.001 seconds).
Test Case '-[KeyPathTests.HelperMaintenanceTests testDetectDuplicateAppCopiesFiltersBuildPathsAndSortsApplicationsFirst]' started.
Test Case '-[KeyPathTests.HelperMaintenanceTests testDetectDuplicateAppCopiesFiltersBuildPathsAndSortsApplicationsFirst]' passed (0.000 seconds).
Test Case '-[KeyPathTests.HelperMaintenanceTests testRunCleanupIsIdempotentWithoutDuplicates]' started.
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair started
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… App copy check: OK (/Applications/KeyPath.app)
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper registered via SMAppService on first attempt
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper responding via XPC
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair finished
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair started
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… App copy check: OK (/Applications/KeyPath.app)
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper registered via SMAppService on first attempt
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper responding via XPC
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair finished
Test Case '-[KeyPathTests.HelperMaintenanceTests testRunCleanupIsIdempotentWithoutDuplicates]' passed (0.001 seconds).
Test Case '-[KeyPathTests.HelperMaintenanceTests testRunCleanupLogsWarningForDuplicateCopies]' started.
[2025-11-22 12:49:36.530] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair started
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)] âš ï¸ Multiple KeyPath.app copies detected:
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)]    - /Applications/KeyPath.app
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)]    - /Users/other/KeyPath.app
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)] â— Background Item approval may point at a non-/Applications copy.
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper registered via SMAppService on first attempt
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)] âœ… Helper responding via XPC
[2025-11-22 12:49:36.531] [INFO] [HelperMaintenance.swift:298 log(_:)] ğŸ§¹ Cleanup & Repair finished
Test Case '-[KeyPathTests.HelperMaintenanceTests testRunCleanupLogsWarningForDuplicateCopies]' passed (0.001 seconds).
Test Suite 'HelperMaintenanceTests' passed at 2025-11-22 12:49:36.531.
	 Executed 5 tests, with 0 failures (0 unexpected) in 0.009 (0.009) seconds
Test Suite 'HelperManagerTests' started at 2025-11-22 12:49:36.531.
Test Case '-[KeyPathTests.HelperManagerTests testInstallHelperAttemptsRegisterWhenStatusIsNotFoundAndSurfacesError]' started.
[2025-11-22 12:49:36.531] [INFO] [HelperManager.swift:430 installHelper()] ğŸ”§ [HelperManager] Registering privileged helper via SMAppService
[2025-11-22 12:49:36.531] [INFO] [HelperManager.swift:437 installHelper()] ğŸ“¦ [HelperManager] App bundle: /Applications/Xcode.app/Contents/Developer/usr/bin
[2025-11-22 12:49:36.531] [INFO] [HelperManager.swift:444 installHelper()] âš ï¸ [HelperManager] Could not read Info.plist
[2025-11-22 12:49:36.531] [INFO] [HelperManager.swift:449 installHelper()] ğŸ” [HelperManager] SMAppService status: 3 (0=notRegistered, 1=enabled, 2=requiresApproval, 3=notFound)
[2025-11-22 12:49:36.531] [INFO] [HelperManager.swift:494 installHelper()] âš ï¸ [HelperManager] Helper status is .notFound - attempting registration anyway to get detailed error
[2025-11-22 12:49:36.531] [INFO] [HelperManager.swift:505 installHelper()] âŒ [HelperManager] Registration failed with detailed error: Codesigning failure loading plist: com.keypath.helper code: -67028 [SMAppServiceErrorDomain:3]
Test Case '-[KeyPathTests.HelperManagerTests testInstallHelperAttemptsRegisterWhenStatusIsNotFoundAndSurfacesError]' passed (0.000 seconds).
Test Suite 'HelperManagerTests' passed at 2025-11-22 12:49:36.532.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.000 (0.000) seconds
Test Suite 'InstallerEngineFunctionalTests' started at 2025-11-22 12:49:36.532.
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testBundledKanataMissingProducesLogWarning]' started.
[2025-11-22 12:49:36.534] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.534] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/Users/tester/.config/keypath
[2025-11-22 12:49:36.534] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.535] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.536] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.536] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.536] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.536] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/missing-kanata
[2025-11-22 12:49:36.536] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.536] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.536] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/missing-kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.537] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.537] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.540] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-7D0E94B5-B30F-475C-AE15-AD5EB25685E5/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testBundledKanataMissingProducesLogWarning]' passed (0.010 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateAllServicesLogsErrorWhenUserConfigDirectoryBlocked]' started.
[2025-11-22 12:49:36.543] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.546] [INFO] [LaunchDaemonInstaller.swift:947 ensureDefaultUserConfigExists()] âŒ [LaunchDaemon] Failed to create default user config: Error Domain=NSCocoaErrorDomain Code=516 "The file â€œkeypathâ€ couldnâ€™t be saved in the folder â€œ.configâ€ because a file with the same name already exists." UserInfo={NSFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2A02D4EF-B65B-45B5-8D34-5B3916EAD864/Users/tester/.config/keypath, NSURL=file:///var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2A02D4EF-B65B-45B5-8D34-5B3916EAD864/Users/tester/.config/keypath, NSUnderlyingError=0xc3296a5b0 {Error Domain=NSPOSIXErrorDomain Code=17 "File exists"}}
[2025-11-22 12:49:36.546] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.546] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.546] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.546] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2A02D4EF-B65B-45B5-8D34-5B3916EAD864/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.547] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.547] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.548] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2A02D4EF-B65B-45B5-8D34-5B3916EAD864/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateAllServicesLogsErrorWhenUserConfigDirectoryBlocked]' passed (0.008 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateAllServicesWritesUserConfig]' started.
[2025-11-22 12:49:36.550] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-4B4E6852-A5E4-4D80-BB61-E5A089CD2166/Users/tester/.config/keypath
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-4B4E6852-A5E4-4D80-BB61-E5A089CD2166/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.551] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.552] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.552] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.552] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-4B4E6852-A5E4-4D80-BB61-E5A089CD2166/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.552] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.552] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.552] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.552] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-4B4E6852-A5E4-4D80-BB61-E5A089CD2166/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.553] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.553] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.554] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-4B4E6852-A5E4-4D80-BB61-E5A089CD2166/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateAllServicesWritesUserConfig]' passed (0.006 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateKanataLaunchDaemonAcknowledgesPendingApproval]' started.
[2025-11-22 12:49:36.556] [INFO] [LaunchDaemonInstaller.swift:412 createKanataLaunchDaemon()] ğŸ”§ [LaunchDaemon] Creating Kanata LaunchDaemon service via SMAppService
[2025-11-22 12:49:36.556] [INFO] [LaunchDaemonInstaller.swift:420 createKanataLaunchDaemonViaSMAppService()] ğŸ“± [LaunchDaemon] Registering Kanata daemon via SMAppService
[2025-11-22 12:49:36.556] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.556] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.556] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 2 (SMAppServiceStatus(rawValue: 2))
[2025-11-22 12:49:36.556] [INFO] [KanataDaemonManager.swift:129 determineServiceManagementState()] â³ [KanataDaemonManager] State: SMAPPSERVICE_PENDING (approval needed)
[2025-11-22 12:49:36.556] [INFO] [LaunchDaemonInstaller.swift:429 createKanataLaunchDaemonViaSMAppService()] ğŸ” [LaunchDaemon] Current state: SMAppService (pending approval)
[2025-11-22 12:49:36.556] [INFO] [LaunchDaemonInstaller.swift:454 createKanataLaunchDaemonViaSMAppService()] âœ… [LaunchDaemon] Already managed by SMAppService (state: SMAppService (pending approval)) - skipping registration
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateKanataLaunchDaemonAcknowledgesPendingApproval]' passed (0.002 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateKanataLaunchDaemonSkipsRegistrationWhenAlreadyManaged]' started.
[2025-11-22 12:49:36.558] [INFO] [LaunchDaemonInstaller.swift:412 createKanataLaunchDaemon()] ğŸ”§ [LaunchDaemon] Creating Kanata LaunchDaemon service via SMAppService
[2025-11-22 12:49:36.558] [INFO] [LaunchDaemonInstaller.swift:420 createKanataLaunchDaemonViaSMAppService()] ğŸ“± [LaunchDaemon] Registering Kanata daemon via SMAppService
[2025-11-22 12:49:36.558] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.558] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.558] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 1 (SMAppServiceStatus(rawValue: 1))
[2025-11-22 12:49:36.559] [INFO] [KanataDaemonManager.swift:126 determineServiceManagementState()] âœ… [KanataDaemonManager] State: SMAPPSERVICE_ACTIVE
[2025-11-22 12:49:36.559] [INFO] [LaunchDaemonInstaller.swift:429 createKanataLaunchDaemonViaSMAppService()] ğŸ” [LaunchDaemon] Current state: SMAppService (active)
[2025-11-22 12:49:36.559] [INFO] [LaunchDaemonInstaller.swift:454 createKanataLaunchDaemonViaSMAppService()] âœ… [LaunchDaemon] Already managed by SMAppService (state: SMAppService (active)) - skipping registration
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testCreateKanataLaunchDaemonSkipsRegistrationWhenAlreadyManaged]' passed (0.002 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testFirstTimeInstallProvisioningFlow]' started.
[2025-11-22 12:49:36.561] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.561] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB15F17B-BBFD-4723-A4A7-C50A410C3F2E/Users/tester/.config/keypath
[2025-11-22 12:49:36.561] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB15F17B-BBFD-4723-A4A7-C50A410C3F2E/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.562] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.563] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.563] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.563] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB15F17B-BBFD-4723-A4A7-C50A410C3F2E/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.563] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.563] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.563] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.563] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB15F17B-BBFD-4723-A4A7-C50A410C3F2E/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.565] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.565] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.566] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB15F17B-BBFD-4723-A4A7-C50A410C3F2E/Library/LaunchDaemons
[2025-11-22 12:49:36.566] [INFO] [LaunchDaemonInstaller.swift:566 loadServices()] ğŸ”§ [LaunchDaemon] Loading all KeyPath LaunchDaemon services
[2025-11-22 12:49:36.566] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.kanata
[2025-11-22 12:49:36.567] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:36.567] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:36.567] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.567] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:36.567] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:36.567] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:36.568] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:36.568] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:36.568] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:36.568] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: true
[2025-11-22 12:49:36.569] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: true
[2025-11-22 12:49:36.569] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:36.569] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: true
[2025-11-22 12:49:36.569] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:36.569] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testFirstTimeInstallProvisioningFlow]' passed (0.012 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallerFailureWhenLaunchDaemonDirectoryIsInvalid]' started.
[2025-11-22 12:49:36.573] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-B6587C0D-60EC-450B-9021-47893233F517/Users/tester/.config/keypath
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-B6587C0D-60EC-450B-9021-47893233F517/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.574] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.575] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.575] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.575] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.575] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.575] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-B6587C0D-60EC-450B-9021-47893233F517/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.575] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.575] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.575] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.575] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-B6587C0D-60EC-450B-9021-47893233F517/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.576] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.576] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.578] [INFO] [LaunchDaemonInstaller.swift:1109 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âŒ [LaunchDaemon] (test) Failed to install plists: Error Domain=NSCocoaErrorDomain Code=516 "The file â€œLaunchDaemonsâ€ couldnâ€™t be saved in the folder â€œLibraryâ€ because a file with the same name already exists." UserInfo={NSFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-B6587C0D-60EC-450B-9021-47893233F517/Library/LaunchDaemons, NSURL=file:///var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-B6587C0D-60EC-450B-9021-47893233F517/Library/LaunchDaemons, NSUnderlyingError=0xc3296a250 {Error Domain=NSPOSIXErrorDomain Code=17 "File exists"}}
[2025-11-22 12:49:36.578] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.578] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.578] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:36.578] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:36.578] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: false
[2025-11-22 12:49:36.578] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:36.579] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: false
[2025-11-22 12:49:36.579] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: false
[2025-11-22 12:49:36.579] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: false
[2025-11-22 12:49:36.579] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:36.580] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: false
[2025-11-22 12:49:36.580] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:36.580] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: false
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallerFailureWhenLaunchDaemonDirectoryIsInvalid]' passed (0.010 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallerFailureWhenLaunchDaemonsDirectoryIsReadOnly]' started.
[2025-11-22 12:49:36.583] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8836086E-67E7-4B5C-AC64-97DF4DDAC097/Users/tester/.config/keypath
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8836086E-67E7-4B5C-AC64-97DF4DDAC097/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.584] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.584] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8836086E-67E7-4B5C-AC64-97DF4DDAC097/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.585] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.585] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.585] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.585] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8836086E-67E7-4B5C-AC64-97DF4DDAC097/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.585] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.585] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.587] [INFO] [LaunchDaemonInstaller.swift:1109 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âŒ [LaunchDaemon] (test) Failed to install plists: Error Domain=NSCocoaErrorDomain Code=513 "â€œcom.keypath.kanata.028ADE10-C72C-4FAA-AA86-EE5C446512DD.plistâ€ couldnâ€™t be copied because you donâ€™t have permission to access â€œLaunchDaemonsâ€." UserInfo={NSSourceFilePathErrorKey=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/com.keypath.kanata.028ADE10-C72C-4FAA-AA86-EE5C446512DD.plist, NSUserStringVariant=(
    Copy
), NSDestinationFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8836086E-67E7-4B5C-AC64-97DF4DDAC097/Library/LaunchDaemons/com.keypath.kanata.plist, NSFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/com.keypath.kanata.028ADE10-C72C-4FAA-AA86-EE5C446512DD.plist, NSURL=file:///var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/com.keypath.kanata.028ADE10-C72C-4FAA-AA86-EE5C446512DD.plist, NSUnderlyingError=0xc32969ef0 {Error Domain=NSPOSIXErrorDomain Code=13 "Permission denied"}}
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallerFailureWhenLaunchDaemonsDirectoryIsReadOnly]' passed (0.064 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallerLogsPermissionDeniedWhenConfigDirectoryCannotBeCreated]' started.
[2025-11-22 12:49:36.650] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.652] [INFO] [LaunchDaemonInstaller.swift:947 ensureDefaultUserConfigExists()] âŒ [LaunchDaemon] Failed to create default user config: Error Domain=NSCocoaErrorDomain Code=513 "You donâ€™t have permission to save the file â€œkeypathâ€ in the folder â€œ.configâ€." UserInfo={NSFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-49E34DF0-CD57-4481-88AB-C6FA28A78203/Users/tester/.config/keypath, NSURL=file:///var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-49E34DF0-CD57-4481-88AB-C6FA28A78203/Users/tester/.config/keypath, NSUnderlyingError=0xc32969ef0 {Error Domain=NSPOSIXErrorDomain Code=13 "Permission denied"}}
[2025-11-22 12:49:36.653] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.653] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.653] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.653] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-49E34DF0-CD57-4481-88AB-C6FA28A78203/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.654] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.654] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.655] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-49E34DF0-CD57-4481-88AB-C6FA28A78203/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallerLogsPermissionDeniedWhenConfigDirectoryCannotBeCreated]' passed (0.115 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallOnlyAttemptsKanataInstallWhenUninstalled]' started.
[2025-11-22 12:49:36.764] [INFO] [LaunchDaemonInstaller.swift:1869 createAllLaunchDaemonServicesInstallOnly()] ğŸ”§ [LaunchDaemon] Installing service files only (no load/start)...
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D81601CE-3586-44B5-B87B-BF2E0B2CB188/Users/tester/.config/keypath
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D81601CE-3586-44B5-B87B-BF2E0B2CB188/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.764] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.765] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.765] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.765] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D81601CE-3586-44B5-B87B-BF2E0B2CB188/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.765] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.765] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.765] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:36.765] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:36.765] [INFO] [LaunchDaemonInstaller.swift:1875 createAllLaunchDaemonServicesInstallOnly()] ğŸ” [LaunchDaemon] Current state: Uninstalled
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:1884 createAllLaunchDaemonServicesInstallOnly()] ğŸ” [LaunchDaemon] Install-only check: state=Uninstalled, shouldSkipKanata=false
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:412 createKanataLaunchDaemon()] ğŸ”§ [LaunchDaemon] Creating Kanata LaunchDaemon service via SMAppService
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:420 createKanataLaunchDaemonViaSMAppService()] ğŸ“± [LaunchDaemon] Registering Kanata daemon via SMAppService
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:429 createKanataLaunchDaemonViaSMAppService()] ğŸ” [LaunchDaemon] Current state: Uninstalled
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:461 createKanataLaunchDaemonViaSMAppService()] ğŸ”§ [LaunchDaemon] Calling KanataDaemonManager.shared.register()...
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:45 init()] ğŸ”§ [KanataDaemonManager] Initialized
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:323 register()] ğŸ”§ [KanataDaemonManager] *** ENTRY POINT *** Registering Kanata daemon via SMAppService
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:325 register()] ğŸ” [KanataDaemonManager] macOS version check: Version 26.0.1 (Build 25A362)
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:332 register()] âœ… [KanataDaemonManager] macOS version OK for SMAppService
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:335 register()] ğŸ§ª [KanataDaemonManager] Test mode detected â€“ bypassing bundle validation
[2025-11-22 12:49:36.831] [INFO] [KanataDaemonManager.swift:339 register()] âœ… [KanataDaemonManager] Test registration completed
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:463 createKanataLaunchDaemonViaSMAppService()] âœ… [LaunchDaemon] Kanata daemon registered via SMAppService - SUCCESS
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:479 createVHIDDaemonService()] ğŸ”§ [LaunchDaemon] Creating VHIDDevice Daemon LaunchDaemon service
[2025-11-22 12:49:36.831] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D81601CE-3586-44B5-B87B-BF2E0B2CB188/Library/LaunchDaemons/com.keypath.karabiner-vhiddaemon.plist
[2025-11-22 12:49:36.832] [INFO] [LaunchDaemonInstaller.swift:489 createVHIDManagerService()] ğŸ”§ [LaunchDaemon] Creating VHIDDevice Manager LaunchDaemon service
[2025-11-22 12:49:36.832] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D81601CE-3586-44B5-B87B-BF2E0B2CB188/Library/LaunchDaemons/com.keypath.karabiner-vhidmanager.plist
[2025-11-22 12:49:36.832] [INFO] [LaunchDaemonInstaller.swift:1902 createAllLaunchDaemonServicesInstallOnly()] ğŸ”§ [LaunchDaemon] Install-only result: kanata=true, vhidDaemon=true, vhidManager=true, overall=true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallOnlyAttemptsKanataInstallWhenUninstalled]' passed (0.071 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallOnlyLogsSkipWhenSMAppServiceActive]' started.
[2025-11-22 12:49:36.834] [INFO] [LaunchDaemonInstaller.swift:1869 createAllLaunchDaemonServicesInstallOnly()] ğŸ”§ [LaunchDaemon] Installing service files only (no load/start)...
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2EAEE590-8E95-4BD6-823A-713994F8EA83/Users/tester/.config/keypath
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2EAEE590-8E95-4BD6-823A-713994F8EA83/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.835] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.835] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2EAEE590-8E95-4BD6-823A-713994F8EA83/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.835] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.835] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.835] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 1 (SMAppServiceStatus(rawValue: 1))
[2025-11-22 12:49:36.835] [INFO] [KanataDaemonManager.swift:126 determineServiceManagementState()] âœ… [KanataDaemonManager] State: SMAPPSERVICE_ACTIVE
[2025-11-22 12:49:36.835] [INFO] [LaunchDaemonInstaller.swift:1875 createAllLaunchDaemonServicesInstallOnly()] ğŸ” [LaunchDaemon] Current state: SMAppService (active)
[2025-11-22 12:49:36.902] [INFO] [LaunchDaemonInstaller.swift:1884 createAllLaunchDaemonServicesInstallOnly()] ğŸ” [LaunchDaemon] Install-only check: state=SMAppService (active), shouldSkipKanata=true
[2025-11-22 12:49:36.902] [INFO] [LaunchDaemonInstaller.swift:1891 createAllLaunchDaemonServicesInstallOnly()] âš ï¸ [LaunchDaemon] Skipping Kanata installation - SMAppService is active or migrated (state: SMAppService (active))
[2025-11-22 12:49:36.902] [INFO] [LaunchDaemonInstaller.swift:479 createVHIDDaemonService()] ğŸ”§ [LaunchDaemon] Creating VHIDDevice Daemon LaunchDaemon service
[2025-11-22 12:49:36.902] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2EAEE590-8E95-4BD6-823A-713994F8EA83/Library/LaunchDaemons/com.keypath.karabiner-vhiddaemon.plist
[2025-11-22 12:49:36.903] [INFO] [LaunchDaemonInstaller.swift:489 createVHIDManagerService()] ğŸ”§ [LaunchDaemon] Creating VHIDDevice Manager LaunchDaemon service
[2025-11-22 12:49:36.903] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-2EAEE590-8E95-4BD6-823A-713994F8EA83/Library/LaunchDaemons/com.keypath.karabiner-vhidmanager.plist
[2025-11-22 12:49:36.904] [INFO] [LaunchDaemonInstaller.swift:1902 createAllLaunchDaemonServicesInstallOnly()] ğŸ”§ [LaunchDaemon] Install-only result: kanata=true, vhidDaemon=true, vhidManager=true, overall=true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallOnlyLogsSkipWhenSMAppServiceActive]' passed (0.072 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallOnlySkipsKanataWhenSMAppServiceActive]' started.
[2025-11-22 12:49:36.910] [INFO] [LaunchDaemonInstaller.swift:1869 createAllLaunchDaemonServicesInstallOnly()] ğŸ”§ [LaunchDaemon] Installing service files only (no load/start)...
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-F447CEC5-2D71-4DC5-B72D-B215AA0B7085/Users/tester/.config/keypath
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-F447CEC5-2D71-4DC5-B72D-B215AA0B7085/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.911] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.912] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.912] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.912] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-F447CEC5-2D71-4DC5-B72D-B215AA0B7085/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.912] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:36.912] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:36.912] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 1 (SMAppServiceStatus(rawValue: 1))
[2025-11-22 12:49:36.912] [INFO] [KanataDaemonManager.swift:126 determineServiceManagementState()] âœ… [KanataDaemonManager] State: SMAPPSERVICE_ACTIVE
[2025-11-22 12:49:36.912] [INFO] [LaunchDaemonInstaller.swift:1875 createAllLaunchDaemonServicesInstallOnly()] ğŸ” [LaunchDaemon] Current state: SMAppService (active)
[2025-11-22 12:49:36.979] [INFO] [LaunchDaemonInstaller.swift:1884 createAllLaunchDaemonServicesInstallOnly()] ğŸ” [LaunchDaemon] Install-only check: state=SMAppService (active), shouldSkipKanata=true
[2025-11-22 12:49:36.979] [INFO] [LaunchDaemonInstaller.swift:1891 createAllLaunchDaemonServicesInstallOnly()] âš ï¸ [LaunchDaemon] Skipping Kanata installation - SMAppService is active or migrated (state: SMAppService (active))
[2025-11-22 12:49:36.979] [INFO] [LaunchDaemonInstaller.swift:479 createVHIDDaemonService()] ğŸ”§ [LaunchDaemon] Creating VHIDDevice Daemon LaunchDaemon service
[2025-11-22 12:49:36.979] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-F447CEC5-2D71-4DC5-B72D-B215AA0B7085/Library/LaunchDaemons/com.keypath.karabiner-vhiddaemon.plist
[2025-11-22 12:49:36.980] [INFO] [LaunchDaemonInstaller.swift:489 createVHIDManagerService()] ğŸ”§ [LaunchDaemon] Creating VHIDDevice Manager LaunchDaemon service
[2025-11-22 12:49:36.980] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-F447CEC5-2D71-4DC5-B72D-B215AA0B7085/Library/LaunchDaemons/com.keypath.karabiner-vhidmanager.plist
[2025-11-22 12:49:36.981] [INFO] [LaunchDaemonInstaller.swift:1902 createAllLaunchDaemonServicesInstallOnly()] ğŸ”§ [LaunchDaemon] Install-only result: kanata=true, vhidDaemon=true, vhidManager=true, overall=true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testInstallOnlySkipsKanataWhenSMAppServiceActive]' passed (0.076 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testKanataPlistInstalledReflectsFilesystem]' started.
[2025-11-22 12:49:36.984] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BA3DE461-24F4-4A52-B52B-E190F4E7EB5F/Users/tester/.config/keypath
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BA3DE461-24F4-4A52-B52B-E190F4E7EB5F/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.984] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.985] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.985] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.985] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BA3DE461-24F4-4A52-B52B-E190F4E7EB5F/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.985] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.985] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.985] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.985] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BA3DE461-24F4-4A52-B52B-E190F4E7EB5F/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.986] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.986] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.986] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BA3DE461-24F4-4A52-B52B-E190F4E7EB5F/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testKanataPlistInstalledReflectsFilesystem]' passed (0.005 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testKanataPlistMigrationExpandsTildePath]' started.
[2025-11-22 12:49:36.988] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:36.988] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D2E41853-3804-44C4-AA78-D94BC598ACFB/Users/tester/.config/keypath
[2025-11-22 12:49:36.988] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D2E41853-3804-44C4-AA78-D94BC598ACFB/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:36.989] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:36.989] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D2E41853-3804-44C4-AA78-D94BC598ACFB/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:36.989] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:36.989] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:36.989] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:36.989] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D2E41853-3804-44C4-AA78-D94BC598ACFB/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:36.990] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:36.990] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:36.990] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D2E41853-3804-44C4-AA78-D94BC598ACFB/Library/LaunchDaemons
[2025-11-22 12:49:36.991] [INFO] [LaunchDaemonInstaller.swift:1995 restartUnhealthyServices()] ğŸ”§ [LaunchDaemon] Starting comprehensive service health fix
[2025-11-22 12:49:36.991] [INFO] [LaunchDaemonInstaller.swift:1043 migrateKanataConfigPathIfNeeded()] ğŸ”§ [LaunchDaemon] Rewriting Kanata plist config path from '~' to /Users/malpern/test/path
[2025-11-22 12:49:36.991] [INFO] [PrivilegedOperationsCoordinator.swift:35 init()] ğŸ” [PrivCoordinator] Initialized with operation mode: directSudo
[2025-11-22 12:49:36.991] [INFO] [PrivilegedOperationsCoordinator.swift:839 sudoExecuteCommand(_:description:)] ğŸ”§ [PrivCoordinator] Executing admin command: update Kanata LaunchDaemon config path
[2025-11-22 12:49:45.627] [INFO] [PrivilegedOperationsCoordinator.swift:844 sudoExecuteCommand(_:description:)] âœ… [PrivCoordinator] Successfully executed: update Kanata LaunchDaemon config path
[2025-11-22 12:49:45.627] [INFO] [LaunchDaemonInstaller.swift:1071 migrateKanataConfigPathIfNeeded()] âœ… [LaunchDaemon] Kanata plist config path migrated to /Users/malpern/test/path
[2025-11-22 12:49:45.627] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:45.627] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:45.627] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:45.627] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: true
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: true
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: true
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: true
[2025-11-22 12:49:45.628] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:45.628] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:45.628] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:45.628] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:2030 restartUnhealthyServices()] ğŸ” [LaunchDaemon] Current state: Legacy launchctl
[2025-11-22 12:49:45.628] [INFO] [LaunchDaemonInstaller.swift:2034 restartUnhealthyServices()] ğŸ”„ [LaunchDaemon] Legacy plist detected - auto-resolving by removing legacy
[2025-11-22 12:49:45.628] [INFO] [PrivilegedOperationsCoordinator.swift:839 sudoExecuteCommand(_:description:)] ğŸ”§ [PrivCoordinator] Executing admin command: Remove legacy plist
[2025-11-22 12:49:50.194] [INFO] [PrivilegedOperationsCoordinator.swift:844 sudoExecuteCommand(_:description:)] âœ… [PrivCoordinator] Successfully executed: Remove legacy plist
[2025-11-22 12:49:50.194] [INFO] [LaunchDaemonInstaller.swift:2046 restartUnhealthyServices()] âœ… [LaunchDaemon] Legacy plist removed
[2025-11-22 12:49:50.194] [INFO] [LaunchDaemonInstaller.swift:2134 restartUnhealthyServices()] ğŸ” [LaunchDaemon] Installation check: needsInstallation=false
[2025-11-22 12:49:50.194] [INFO] [LaunchDaemonInstaller.swift:2136 restartUnhealthyServices()] ğŸ” [LaunchDaemon] Services to install after state check: []
[2025-11-22 12:49:50.194] [INFO] [LaunchDaemonInstaller.swift:2153 restartUnhealthyServices()] ğŸ” [LaunchDaemon] No installation/migration needed - services using correct method
[2025-11-22 12:49:50.194] [INFO] [LaunchDaemonInstaller.swift:2159 restartUnhealthyServices()] ğŸ” [LaunchDaemon] No unhealthy services found to restart
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testKanataPlistMigrationExpandsTildePath]' passed (13.209 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testLoadServicesFailsWhenServiceDefinitionMissing]' started.
[2025-11-22 12:49:50.199] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-DDB2DBB5-DB8E-42B9-A248-9E32F1749613/Users/tester/.config/keypath
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-DDB2DBB5-DB8E-42B9-A248-9E32F1749613/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.199] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.200] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.200] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-DDB2DBB5-DB8E-42B9-A248-9E32F1749613/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-DDB2DBB5-DB8E-42B9-A248-9E32F1749613/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.200] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.201] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-DDB2DBB5-DB8E-42B9-A248-9E32F1749613/Library/LaunchDaemons
[2025-11-22 12:49:50.201] [INFO] [LaunchDaemonInstaller.swift:566 loadServices()] ğŸ”§ [LaunchDaemon] Loading all KeyPath LaunchDaemon services
[2025-11-22 12:49:50.201] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.kanata
[2025-11-22 12:49:50.201] [INFO] [LaunchDaemonInstaller.swift:575 loadServices()] âŒ [LaunchDaemon] Failed to load service: com.keypath.kanata
[2025-11-22 12:49:50.201] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.202] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:50.202] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:50.202] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:50.202] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: false
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: false
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: true
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: true
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: true
[2025-11-22 12:49:50.202] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.203] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testLoadServicesFailsWhenServiceDefinitionMissing]' passed (0.008 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testMissingKanataServiceTriggersReinstall]' started.
[2025-11-22 12:49:50.206] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Users/tester/.config/keypath
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.206] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.206] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.207] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.207] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.207] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.207] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.207] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.207] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.208] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Library/LaunchDaemons
[2025-11-22 12:49:50.208] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.208] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.208] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.208] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.208] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.209] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.209] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.209] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-824AA677-FC38-4871-9BD8-4527F9D7793C/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testMissingKanataServiceTriggersReinstall]' passed (0.005 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testMissingVirtualHIDServiceTriggersReinstall]' started.
[2025-11-22 12:49:50.211] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Users/tester/.config/keypath
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.211] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.212] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.212] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.212] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.213] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Library/LaunchDaemons
[2025-11-22 12:49:50.213] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.213] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.213] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.213] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.213] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.214] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.214] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.214] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6CAFF463-6AE1-49FE-8DE2-C5C3BA595293/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testMissingVirtualHIDServiceTriggersReinstall]' passed (0.005 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testRepairFlowRestoresMissingVhidServices]' started.
[2025-11-22 12:49:50.216] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Users/tester/.config/keypath
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.216] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.217] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.217] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.217] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.218] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Library/LaunchDaemons
[2025-11-22 12:49:50.218] [INFO] [LaunchDaemonInstaller.swift:566 loadServices()] ğŸ”§ [LaunchDaemon] Loading all KeyPath LaunchDaemon services
[2025-11-22 12:49:50.218] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.kanata
[2025-11-22 12:49:50.219] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.219] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.220] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:50.220] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:50.220] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:50.220] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: false
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: false
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: false
[2025-11-22 12:49:50.220] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.221] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: false
[2025-11-22 12:49:50.221] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.221] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.221] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.221] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.221] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.222] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.222] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.222] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-BB720A2B-AE99-4B79-8A73-85A065229E46/Library/LaunchDaemons
[2025-11-22 12:49:50.222] [INFO] [LaunchDaemonInstaller.swift:566 loadServices()] ğŸ”§ [LaunchDaemon] Loading all KeyPath LaunchDaemon services
[2025-11-22 12:49:50.222] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.kanata
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.223] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:50.223] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:50.223] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:50.223] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: true
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: true
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: true
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.223] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testRepairFlowRestoresMissingVhidServices]' passed (0.018 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testReRunningInstallerDoesNotChangeExistingServiceDefinitions]' started.
[2025-11-22 12:49:50.234] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Users/tester/.config/keypath
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.234] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.234] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.234] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.234] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.234] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.235] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.235] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.235] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.236] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Library/LaunchDaemons
[2025-11-22 12:49:50.236] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.236] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.236] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.236] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.236] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.237] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.237] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.238] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-6D80C38C-2BB4-4784-B7A9-A3CEDC8F044A/Library/LaunchDaemons
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testReRunningInstallerDoesNotChangeExistingServiceDefinitions]' passed (0.006 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testReRunningInstallerFailsWhenDuplicatePlistDirectoryExists]' started.
[2025-11-22 12:49:50.240] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Users/tester/.config/keypath
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.240] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.240] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.240] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.240] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.240] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.240] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.241] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.241] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.241] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Library/LaunchDaemons
[2025-11-22 12:49:50.242] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.242] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.242] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.242] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.242] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.243] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.243] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.243] [INFO] [LaunchDaemonInstaller.swift:1109 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âŒ [LaunchDaemon] (test) Failed to install plists: Error Domain=NSCocoaErrorDomain Code=516 "The file â€œLaunchDaemonsâ€ couldnâ€™t be saved in the folder â€œLibraryâ€ because a file with the same name already exists." UserInfo={NSFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Library/LaunchDaemons, NSURL=file:///var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-64EE60F9-4A47-4B48-89A1-0B943166EF46/Library/LaunchDaemons, NSUnderlyingError=0xc3296a190 {Error Domain=NSPOSIXErrorDomain Code=17 "File exists"}}
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testReRunningInstallerFailsWhenDuplicatePlistDirectoryExists]' passed (0.112 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testReRunningInstallerFailsWhenLaunchDaemonDirectoryReadOnly]' started.
[2025-11-22 12:49:50.351] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Users/tester/.config/keypath
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.352] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.352] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.352] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.352] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.352] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.352] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.353] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.353] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.354] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Library/LaunchDaemons
[2025-11-22 12:49:50.354] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.354] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.354] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.354] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.354] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.355] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.355] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.356] [INFO] [LaunchDaemonInstaller.swift:1109 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âŒ [LaunchDaemon] (test) Failed to install plists: Error Domain=NSCocoaErrorDomain Code=516 "â€œcom.keypath.kanata.E0A7841A-83D2-4A02-B198-2F73DB547A73.plistâ€ couldnâ€™t be copied to â€œLaunchDaemonsâ€ because an item with the same name already exists." UserInfo={NSSourceFilePathErrorKey=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/com.keypath.kanata.E0A7841A-83D2-4A02-B198-2F73DB547A73.plist, NSUserStringVariant=(
    Copy
), NSDestinationFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-48DC931B-1C45-4C25-8402-1FF3C9867160/Library/LaunchDaemons/com.keypath.kanata.plist, NSFilePath=/var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/com.keypath.kanata.E0A7841A-83D2-4A02-B198-2F73DB547A73.plist, NSURL=file:///var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/com.keypath.kanata.E0A7841A-83D2-4A02-B198-2F73DB547A73.plist, NSUnderlyingError=0xc32969ef0 {Error Domain=NSPOSIXErrorDomain Code=17 "File exists"}}
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testReRunningInstallerFailsWhenLaunchDaemonDirectoryReadOnly]' passed (0.112 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testRestartUnhealthyServicesRepairsMissingVhidServices]' started.
[2025-11-22 12:49:50.464] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:50.464] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Users/tester/.config/keypath
[2025-11-22 12:49:50.464] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:50.465] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:50.465] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:50.465] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:50.465] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:50.465] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:50.465] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:50.466] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:50.466] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:50.467] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Library/LaunchDaemons
[2025-11-22 12:49:50.467] [INFO] [LaunchDaemonInstaller.swift:566 loadServices()] ğŸ”§ [LaunchDaemon] Loading all KeyPath LaunchDaemon services
[2025-11-22 12:49:50.467] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.kanata
[2025-11-22 12:49:50.467] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.467] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.467] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:50.467] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:50.467] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:50.467] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: false
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: false
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: false
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: false
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:1995 restartUnhealthyServices()] ğŸ”§ [LaunchDaemon] Starting comprehensive service health fix
[2025-11-22 12:49:50.468] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:50.468] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:50.468] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:50.468] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:50.468] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: false
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: false
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: false
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: false
[2025-11-22 12:49:50.469] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:50.469] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:50.469] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:50.469] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:2030 restartUnhealthyServices()] ğŸ” [LaunchDaemon] Current state: Legacy launchctl
[2025-11-22 12:49:50.469] [INFO] [LaunchDaemonInstaller.swift:2034 restartUnhealthyServices()] ğŸ”„ [LaunchDaemon] Legacy plist detected - auto-resolving by removing legacy
[2025-11-22 12:49:50.469] [INFO] [PrivilegedOperationsCoordinator.swift:839 sudoExecuteCommand(_:description:)] ğŸ”§ [PrivCoordinator] Executing admin command: Remove legacy plist
[2025-11-22 12:49:54.227] [INFO] [PrivilegedOperationsCoordinator.swift:844 sudoExecuteCommand(_:description:)] âœ… [PrivCoordinator] Successfully executed: Remove legacy plist
[2025-11-22 12:49:54.227] [INFO] [LaunchDaemonInstaller.swift:2046 restartUnhealthyServices()] âœ… [LaunchDaemon] Legacy plist removed
[2025-11-22 12:49:54.227] [INFO] [LaunchDaemonInstaller.swift:2134 restartUnhealthyServices()] ğŸ” [LaunchDaemon] Installation check: needsInstallation=true
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:2136 restartUnhealthyServices()] ğŸ” [LaunchDaemon] Services to install after state check: ["com.keypath.karabiner-vhiddaemon", "com.keypath.karabiner-vhidmanager"]
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:2142 restartUnhealthyServices()] ğŸ”§ [LaunchDaemon] Installing missing services: ["com.keypath.karabiner-vhiddaemon", "com.keypath.karabiner-vhidmanager"]
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:502 createConfigureAndLoadAllServices()] ğŸ”§ [LaunchDaemon] Creating, configuring, and loading all services
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:503 createConfigureAndLoadAllServices()] ğŸ“± [LaunchDaemon] Using SMAppService for Kanata, launchctl for VirtualHID
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:511 createConfigureAndLoadAllServicesWithSMAppService()] ğŸ“± [LaunchDaemon] Installing VirtualHID via launchctl, Kanata via SMAppService
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:1631 executeConsolidatedInstallationForVHIDOnly()] ğŸ”§ [LaunchDaemon] Installing VirtualHID services via privileged helper
[2025-11-22 12:49:54.228] [INFO] [PrivilegedOperationsCoordinator.swift:217 repairVHIDDaemonServices()] ğŸ” [PrivCoordinator] Repairing VHID daemon services
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:2453 repairVHIDDaemonServices()] ğŸ”§ [LaunchDaemon] Repairing VHID LaunchDaemon services (DriverKit paths)
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:624 unloadService(serviceID:)] ğŸ”§ [LaunchDaemon] Unloading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:624 unloadService(serviceID:)] ğŸ”§ [LaunchDaemon] Unloading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:54.228] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Library/LaunchDaemons/com.keypath.karabiner-vhiddaemon.plist
[2025-11-22 12:49:54.229] [INFO] [LaunchDaemonInstaller.swift:954 installPlist(content:path:serviceID:)] ğŸ”§ [LaunchDaemon] Installing plist: /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-D7EE8E89-C762-48D9-87DB-E4BC4788642A/Library/LaunchDaemons/com.keypath.karabiner-vhidmanager.plist
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:1919 isVHIDDaemonConfiguredCorrectly()] ğŸ” [LaunchDaemon] VHID plist ProgramArguments[0]=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | expected=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | ok=true
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:1919 isVHIDDaemonConfiguredCorrectly()] ğŸ” [LaunchDaemon] VHID plist ProgramArguments[0]=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | expected=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | ok=true
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:2482 repairVHIDDaemonServices()] ğŸ” [LaunchDaemon] Repair result: loadedDaemon=true, loadedManager=true, configured=true
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:1634 executeConsolidatedInstallationForVHIDOnly()] âœ… [LaunchDaemon] VirtualHID services installed via helper path
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:540 createConfigureAndLoadAllServicesWithSMAppService()] ğŸ“± [LaunchDaemon] Installing Kanata via SMAppService...
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:412 createKanataLaunchDaemon()] ğŸ”§ [LaunchDaemon] Creating Kanata LaunchDaemon service via SMAppService
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:420 createKanataLaunchDaemonViaSMAppService()] ğŸ“± [LaunchDaemon] Registering Kanata daemon via SMAppService
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:429 createKanataLaunchDaemonViaSMAppService()] ğŸ” [LaunchDaemon] Current state: Uninstalled
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:461 createKanataLaunchDaemonViaSMAppService()] ğŸ”§ [LaunchDaemon] Calling KanataDaemonManager.shared.register()...
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:323 register()] ğŸ”§ [KanataDaemonManager] *** ENTRY POINT *** Registering Kanata daemon via SMAppService
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:325 register()] ğŸ” [KanataDaemonManager] macOS version check: Version 26.0.1 (Build 25A362)
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:332 register()] âœ… [KanataDaemonManager] macOS version OK for SMAppService
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:335 register()] ğŸ§ª [KanataDaemonManager] Test mode detected â€“ bypassing bundle validation
[2025-11-22 12:49:54.230] [INFO] [KanataDaemonManager.swift:339 register()] âœ… [KanataDaemonManager] Test registration completed
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:463 createKanataLaunchDaemonViaSMAppService()] âœ… [LaunchDaemon] Kanata daemon registered via SMAppService - SUCCESS
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:552 createConfigureAndLoadAllServicesWithSMAppService()] âœ… [LaunchDaemon] All services installed (VirtualHID via launchctl, Kanata via SMAppService)
[2025-11-22 12:49:54.230] [INFO] [LaunchDaemonInstaller.swift:2148 restartUnhealthyServices()] âœ… [LaunchDaemon] Successfully installed services
[2025-11-22 12:49:56.313] [INFO] [LaunchDaemonInstaller.swift:2159 restartUnhealthyServices()] ğŸ” [LaunchDaemon] No unhealthy services found to restart
[2025-11-22 12:49:56.314] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:56.314] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:56.314] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 1 (SMAppServiceStatus(rawValue: 1))
[2025-11-22 12:49:56.314] [INFO] [KanataDaemonManager.swift:126 determineServiceManagementState()] âœ… [KanataDaemonManager] State: SMAPPSERVICE_ACTIVE
[2025-11-22 12:49:56.382] [INFO] [LaunchDaemonInstaller.swift:1836 getServiceStatus()] ğŸ” [LaunchDaemon] Kanata SMAppService-managed: loaded=true, healthy=false
[2025-11-22 12:49:56.382] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: true
[2025-11-22 12:49:56.382] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: true
[2025-11-22 12:49:56.382] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:56.382] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: true
[2025-11-22 12:49:56.382] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:56.383] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: true
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testRestartUnhealthyServicesRepairsMissingVhidServices]' passed (5.923 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testServiceStatusDetectsMissingVhidManager]' started.
[2025-11-22 12:49:56.390] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8FE8C595-C03B-4F49-8F50-EABC301FD70D/Users/tester/.config/keypath
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8FE8C595-C03B-4F49-8F50-EABC301FD70D/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:56.391] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:56.392] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:56.392] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:56.392] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8FE8C595-C03B-4F49-8F50-EABC301FD70D/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:56.392] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:56.392] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:56.392] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:56.392] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8FE8C595-C03B-4F49-8F50-EABC301FD70D/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:56.393] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:56.393] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:56.394] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-8FE8C595-C03B-4F49-8F50-EABC301FD70D/Library/LaunchDaemons
[2025-11-22 12:49:56.394] [INFO] [LaunchDaemonInstaller.swift:566 loadServices()] ğŸ”§ [LaunchDaemon] Loading all KeyPath LaunchDaemon services
[2025-11-22 12:49:56.394] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.kanata
[2025-11-22 12:49:56.395] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:56.395] [INFO] [LaunchDaemonInstaller.swift:586 loadService(serviceID:)] ğŸ”§ [LaunchDaemon] Loading service: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:56.395] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:56.395] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: true
[2025-11-22 12:49:56.395] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:56.395] [INFO] [KanataDaemonManager.swift:119 determineServiceManagementState()] âœ… [KanataDaemonManager] State: LEGACY_ACTIVE (plist exists)
[2025-11-22 12:49:56.395] [INFO] [LaunchDaemonInstaller.swift:664 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Kanata service loaded via file existence: true
[2025-11-22 12:49:56.395] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:56.395] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.kanata considered healthy: true
[2025-11-22 12:49:56.396] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: true
[2025-11-22 12:49:56.396] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: false
[2025-11-22 12:49:56.396] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:56.396] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: true
[2025-11-22 12:49:56.396] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:56.396] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: false
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testServiceStatusDetectsMissingVhidManager]' passed (0.012 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testSMAppServicePendingApprovalTriggersNotification]' started.
[2025-11-22 12:49:56.400] [INFO] [PrivilegedOperationsCoordinator.swift:157 installServicesIfUninstalled(context:)] [ServiceInstallGuard] pending-flow: state=SMAppService (pending approval)
[2025-11-22 12:49:56.400] [INFO] [PrivilegedOperationsCoordinator.swift:893 notifySMAppServiceApprovalRequired(context:)] âš ï¸ [ServiceInstallGuard] pending-flow: SMAppService pending approval - notifying UI
[2025-11-22 12:49:56.400] [INFO] [PrivilegedOperationsCoordinator.swift:161 installServicesIfUninstalled(context:)] [ServiceInstallGuard] pending-flow: approval pending - skipping install/refresh
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testSMAppServicePendingApprovalTriggersNotification]' passed (0.002 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testSMAppServiceRegistrationFailureIsSurfaced]' started.
[2025-11-22 12:49:56.402] [INFO] [LaunchDaemonInstaller.swift:412 createKanataLaunchDaemon()] ğŸ”§ [LaunchDaemon] Creating Kanata LaunchDaemon service via SMAppService
[2025-11-22 12:49:56.402] [INFO] [LaunchDaemonInstaller.swift:420 createKanataLaunchDaemonViaSMAppService()] ğŸ“± [LaunchDaemon] Registering Kanata daemon via SMAppService
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 0 (SMAppServiceStatus(rawValue: 0))
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:56.402] [INFO] [LaunchDaemonInstaller.swift:429 createKanataLaunchDaemonViaSMAppService()] ğŸ” [LaunchDaemon] Current state: Uninstalled
[2025-11-22 12:49:56.402] [INFO] [LaunchDaemonInstaller.swift:461 createKanataLaunchDaemonViaSMAppService()] ğŸ”§ [LaunchDaemon] Calling KanataDaemonManager.shared.register()...
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:323 register()] ğŸ”§ [KanataDaemonManager] *** ENTRY POINT *** Registering Kanata daemon via SMAppService
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:325 register()] ğŸ” [KanataDaemonManager] macOS version check: Version 26.0.1 (Build 25A362)
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:332 register()] âœ… [KanataDaemonManager] macOS version OK for SMAppService
[2025-11-22 12:49:56.402] [INFO] [KanataDaemonManager.swift:335 register()] ğŸ§ª [KanataDaemonManager] Test mode detected â€“ bypassing bundle validation
[2025-11-22 12:49:56.403] [INFO] [LaunchDaemonInstaller.swift:467 createKanataLaunchDaemonViaSMAppService()] âŒ [LaunchDaemon] SMAppService registration failed: The operation couldnâ€™t be completed. (TestSMAppService error 1.)
[2025-11-22 12:49:56.403] [INFO] [LaunchDaemonInstaller.swift:469 createKanataLaunchDaemonViaSMAppService()] ğŸ’¡ [LaunchDaemon] User may need to approve in System Settings
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testSMAppServiceRegistrationFailureIsSurfaced]' passed (0.003 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testSMAppServiceStateReportsKanataLoadedWithoutLegacyPlist]' started.
[2025-11-22 12:49:56.406] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:56.406] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:56.406] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 1 (SMAppServiceStatus(rawValue: 1))
[2025-11-22 12:49:56.406] [INFO] [KanataDaemonManager.swift:126 determineServiceManagementState()] âœ… [KanataDaemonManager] State: SMAPPSERVICE_ACTIVE
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:1836 getServiceStatus()] ğŸ” [LaunchDaemon] Kanata SMAppService-managed: loaded=true, healthy=false
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered loaded: false
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:704 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered loaded: false
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhiddaemon considered healthy: false
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:56.474] [INFO] [LaunchDaemonInstaller.swift:740 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] (test) Service com.keypath.karabiner-vhidmanager considered healthy: false
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testSMAppServiceStateReportsKanataLoadedWithoutLegacyPlist]' passed (0.073 seconds).
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testVhidConfigurationDetection]' started.
[2025-11-22 12:49:56.479] [INFO] [LaunchDaemonInstaller.swift:312 createAllLaunchDaemonServices()] ğŸ”§ [LaunchDaemon] Creating all LaunchDaemon services
[2025-11-22 12:49:56.479] [INFO] [ConfigurationService.swift:483 createInitialConfigIfNeeded()] âœ… [ConfigService] Config directory created at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-75F9B342-EA01-48FF-8D62-CF1C9F6CC4C6/Users/tester/.config/keypath
[2025-11-22 12:49:56.479] [INFO] [ConfigurationService.swift:488 createInitialConfigIfNeeded()] âš ï¸ [ConfigService] No existing config found at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-75F9B342-EA01-48FF-8D62-CF1C9F6CC4C6/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:509 saveConfiguration(ruleCollections:customRules:)] ğŸ” [ConfigService] Validating config before save...
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:616 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION START ==========
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:617 validateConfiguration(_:)] ğŸ” [Validation] Config size: 725 characters
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:620 validateConfiguration(_:)] ğŸ§ª [Validation] Test mode detected â€“ using lightweight validation
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:916 extractKeyMappingsFromContent(_:)] ğŸ” [Parse] Found 10 src keys, 10 layer keys, deduplicated to 10 unique mappings
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:622 validateConfiguration(_:)] ğŸ” [Validation] ========== CONFIG VALIDATION END ==========
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:518 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Config validation passed
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:540 saveConfiguration(ruleCollections:customRules:)] âœ… [ConfigService] Configuration saved with 0 mappings
[2025-11-22 12:49:56.480] [INFO] [ConfigurationService.swift:492 createInitialConfigIfNeeded()] âœ… [ConfigService] Created initial empty configuration
[2025-11-22 12:49:56.480] [INFO] [LaunchDaemonInstaller.swift:945 ensureDefaultUserConfigExists()] âœ… [LaunchDaemon] Created default user config at /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-75F9B342-EA01-48FF-8D62-CF1C9F6CC4C6/Users/tester/.config/keypath/keypath.kbd
[2025-11-22 12:49:56.480] [INFO] [LaunchDaemonInstaller.swift:232 getKanataBinaryPath()] âŒ [LaunchDaemon] Bundled Kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:49:56.480] [INFO] [LaunchDaemonInstaller.swift:233 getKanataBinaryPath()] ğŸ’¡ [LaunchDaemon] User may need to reinstall Kanata components before proceeding
[2025-11-22 12:49:56.480] [INFO] [LaunchDaemonInstaller.swift:2689 buildKanataPlistArguments(binaryPath:)] ğŸ“¡ [LaunchDaemon] TCP server enabled on port 45000
[2025-11-22 12:49:56.480] [INFO] [LaunchDaemonInstaller.swift:2705 buildKanataPlistArguments(binaryPath:)] ğŸ”§ [LaunchDaemon] Built plist arguments: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata --cfg /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-75F9B342-EA01-48FF-8D62-CF1C9F6CC4C6/Users/tester/.config/keypath/keypath.kbd --port 45000 --debug --log-layer-changes
[2025-11-22 12:49:56.481] [INFO] [LaunchDaemonInstaller.swift:361 createAllLaunchDaemonServices()] ğŸ§ª [LaunchDaemon] Test mode without auth-script override â€“ using local installer path
[2025-11-22 12:49:56.481] [INFO] [LaunchDaemonInstaller.swift:1089 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] ğŸ”§ [LaunchDaemon] Requesting admin privileges to install all services
[2025-11-22 12:49:56.482] [INFO] [LaunchDaemonInstaller.swift:1104 executeAllWithAdminPrivileges(kanataTemp:vhidDaemonTemp:vhidManagerTemp:)] âœ… [LaunchDaemon] (test) Installed all plists to /var/folders/nj/b7p4n70x5sl6q3x8cz3pn3zm0000gn/T/installer-engine-75F9B342-EA01-48FF-8D62-CF1C9F6CC4C6/Library/LaunchDaemons
[2025-11-22 12:49:56.482] [INFO] [LaunchDaemonInstaller.swift:1919 isVHIDDaemonConfiguredCorrectly()] ğŸ” [LaunchDaemon] VHID plist ProgramArguments[0]=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | expected=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | ok=true
[2025-11-22 12:49:56.482] [INFO] [LaunchDaemonInstaller.swift:1919 isVHIDDaemonConfiguredCorrectly()] ğŸ” [LaunchDaemon] VHID plist ProgramArguments[0]=/tmp/bad-path | expected=/Library/Application Support/org.pqrs/Karabiner-DriverKit-VirtualHIDDevice/Applications/Karabiner-VirtualHIDDevice-Daemon.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Daemon | ok=false
Test Case '-[KeyPathTests.InstallerEngineFunctionalTests testVhidConfigurationDetection]' passed (0.006 seconds).
Test Suite 'InstallerEngineFunctionalTests' passed at 2025-11-22 12:49:56.484.
	 Executed 27 tests, with 0 failures (0 unexpected) in 19.948 (19.952) seconds
Test Suite 'InstallerEngineTests' started at 2025-11-22 12:49:56.484.
Test Case '-[KeyPathTests.InstallerEngineTests testAllAutoFixActionsHaveRecipes]' started.
[2025-11-22 12:49:56.484] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:56.484] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:49:56.484] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:49:56.484] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:49:56.484] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:49:56.484] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844596.484
[2025-11-22 12:49:56.484] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:49:56.484] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:49:56.484] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:49:56.484] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:49:56.484] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:49:56.484] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:49:56.484] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:49:56.489] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:49:56.492] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:49:56.506] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:49:56.506] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:49:56.506] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:49:56.506] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:49:56.506] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:49:56.507] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:56.552] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:49:56.552] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:49:57.123] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.065s)
[2025-11-22 12:49:57.123] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:49:57.123] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:49:57.124] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:49:57.124] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:49:57.124] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:57.192] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:49:57.193] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:49:57.193] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:49:57.193] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:49:57.193] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:57.260] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:49:57.327] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:49:57.395] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:49:57.395] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:57.460] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:49:57.460] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:49:57.528] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:49:57.528] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:49:57.528] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.044s
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 1.044s
[2025-11-22 12:49:57.528] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:49:57.528] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:49:57.596] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:49:57.596] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:49:57.660] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:49:57.727] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.066s)
[2025-11-22 12:49:57.727] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:49:58.300] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:49:58.300] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:49:58.300] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:49:58.300] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:49:58.300] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.816s
[2025-11-22 12:49:58.300] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:49:58.300] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=1.816s
[2025-11-22 12:49:58.300] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.816s
[2025-11-22 12:49:58.300] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:49:59.581] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:49:59.582] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:49:59.582] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.098s
[2025-11-22 12:49:59.582] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:49:59.582] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.098s
[2025-11-22 12:49:59.582] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.098s
[2025-11-22 12:49:59.582] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:49:59.582] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:59.582] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:59.583] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:49:59.583] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
Test Case '-[KeyPathTests.InstallerEngineTests testAllAutoFixActionsHaveRecipes]' passed (3.102 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteExecutesRecipesInOrder]' started.
[2025-11-22 12:49:59.586] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:49:59.586] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:49:59.586] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:49:59.586] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:49:59.586] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:49:59.586] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844599.586
[2025-11-22 12:49:59.586] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:49:59.586] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:49:59.586] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:49:59.586] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:49:59.587] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:49:59.587] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:49:59.587] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:49:59.598] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:49:59.608] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:49:59.627] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:49:59.627] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:49:59.627] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:49:59.627] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:49:59.627] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:49:59.628] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:49:59.655] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:49:59.655] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:00.228] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:50:00.228] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:00.228] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:00.229] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:00.229] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:00.229] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:00.296] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:00.297] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:00.297] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:00.297] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:00.297] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:00.298] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:00.298] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:00.298] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:00.298] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:00.298] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:00.298] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:00.298] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:00.365] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:00.431] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:00.498] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:00.498] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:00.565] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:00.565] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:00.631] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:00.631] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:00.631] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.045s
[2025-11-22 12:50:00.631] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:00.631] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:00.631] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:00.631] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:00.631] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:00.631] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:00.632] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:00.632] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 1.045s
[2025-11-22 12:50:00.632] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:00.700] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:00.700] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:00.768] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:00.835] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:50:00.835] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:01.409] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:01.409] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:01.409] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:01.409] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:01.409] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.823s
[2025-11-22 12:50:01.409] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:50:01.409] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=1.823s
[2025-11-22 12:50:01.409] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.823s
[2025-11-22 12:50:01.409] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:50:02.667] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:02.667] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:02.667] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:50:02.667] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.081s
[2025-11-22 12:50:02.667] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:50:02.668] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.081s
[2025-11-22 12:50:02.668] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.081s
[2025-11-22 12:50:02.668] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:02.668] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:88 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Starting makePlan(for: install, context:)
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:105 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Determined 5 actions for intent: install
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:110 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Generated 5 recipes
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:123 makePlan(for:context:)] âœ… [InstallerEngine] makePlan() complete - status: ready, recipes: 5
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:390 execute(plan:using:)] âš™ï¸ [InstallerEngine] Starting execute(plan:, using:)
[2025-11-22 12:50:02.668] [INFO] [InstallerEngine.swift:409 execute(plan:using:)] âš™ï¸ [InstallerEngine] Executing recipe: install-bundled-kanata (type: installComponent)
[2025-11-22 12:50:02.668] [INFO] [PrivilegedOperationsCoordinator.swift:359 installBundledKanata()] ğŸ” [PrivCoordinator] Installing bundled Kanata binary
[2025-11-22 12:50:02.669] [INFO] [LaunchDaemonInstaller.swift:2898 installBundledKanataBinaryOnly()] ğŸ”§ [LaunchDaemon] Installing bundled kanata binary to system location
[2025-11-22 12:50:02.669] [INFO] [LaunchDaemonInstaller.swift:2906 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] CRITICAL: Bundled kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:50:02.669] [INFO] [LaunchDaemonInstaller.swift:2908 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] This indicates a packaging issue - the app bundle is missing the kanata binary
[2025-11-22 12:50:02.669] [INFO] [InstallerEngine.swift:451 execute(plan:using:)] âŒ [InstallerEngine] Recipe install-bundled-kanata failed: Operation failed: Bundled Kanata installation failed
[2025-11-22 12:50:02.669] [INFO] [InstallerEngine.swift:470 execute(plan:using:)] âœ… [InstallerEngine] execute() complete - success: false, recipes executed: 1
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteExecutesRecipesInOrder]' passed (3.084 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteHandlesBlockedPlan]' started.
[2025-11-22 12:50:02.670] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:02.670] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:02.670] [INFO] [InstallerEngine.swift:390 execute(plan:using:)] âš™ï¸ [InstallerEngine] Starting execute(plan:, using:)
[2025-11-22 12:50:02.670] [INFO] [InstallerEngine.swift:394 execute(plan:using:)] âš ï¸ [InstallerEngine] Plan is blocked by requirement: Test requirement
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteHandlesBlockedPlan]' passed (0.000 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteRecordsRecipeResults]' started.
[2025-11-22 12:50:02.670] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:02.670] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:02.670] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844602.670
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:50:02.670] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:50:02.670] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:50:02.670] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:50:02.671] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:50:02.671] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:50:02.676] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:02.681] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:02.697] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:50:02.697] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:50:02.697] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:50:02.697] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:50:02.697] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:50:02.698] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:02.739] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:02.739] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:03.313] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:03.313] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:03.313] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:03.313] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:03.313] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:03.313] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:03.380] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:03.381] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:03.381] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:03.381] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:03.381] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:03.448] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:03.516] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:03.582] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:03.583] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:03.649] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:03.649] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:03.718] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.048s
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:03.718] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:03.718] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:03.718] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 1.048s
[2025-11-22 12:50:03.718] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:03.785] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:03.785] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:03.853] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:03.922] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:03.922] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:04.493] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.069s)
[2025-11-22 12:50:04.493] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:04.493] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:04.493] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:04.493] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.823s
[2025-11-22 12:50:04.493] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:50:04.493] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=1.823s
[2025-11-22 12:50:04.493] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.823s
[2025-11-22 12:50:04.493] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:50:05.761] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:05.761] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:50:05.761] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:05.762] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.091s
[2025-11-22 12:50:05.762] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:50:05.762] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.092s
[2025-11-22 12:50:05.762] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.092s
[2025-11-22 12:50:05.762] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:50:05.762] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:05.762] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:05.762] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:50:05.762] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:05.762] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:50:05.762] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:50:05.763] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:05.763] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:88 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Starting makePlan(for: install, context:)
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:105 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Determined 5 actions for intent: install
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:110 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Generated 5 recipes
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:123 makePlan(for:context:)] âœ… [InstallerEngine] makePlan() complete - status: ready, recipes: 5
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:390 execute(plan:using:)] âš™ï¸ [InstallerEngine] Starting execute(plan:, using:)
[2025-11-22 12:50:05.763] [INFO] [InstallerEngine.swift:409 execute(plan:using:)] âš™ï¸ [InstallerEngine] Executing recipe: install-bundled-kanata (type: installComponent)
[2025-11-22 12:50:05.763] [INFO] [PrivilegedOperationsCoordinator.swift:359 installBundledKanata()] ğŸ” [PrivCoordinator] Installing bundled Kanata binary
[2025-11-22 12:50:05.763] [INFO] [LaunchDaemonInstaller.swift:2898 installBundledKanataBinaryOnly()] ğŸ”§ [LaunchDaemon] Installing bundled kanata binary to system location
[2025-11-22 12:50:05.763] [INFO] [LaunchDaemonInstaller.swift:2906 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] CRITICAL: Bundled kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:50:05.764] [INFO] [LaunchDaemonInstaller.swift:2908 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] This indicates a packaging issue - the app bundle is missing the kanata binary
[2025-11-22 12:50:05.764] [INFO] [InstallerEngine.swift:451 execute(plan:using:)] âŒ [InstallerEngine] Recipe install-bundled-kanata failed: Operation failed: Bundled Kanata installation failed
[2025-11-22 12:50:05.764] [INFO] [InstallerEngine.swift:470 execute(plan:using:)] âœ… [InstallerEngine] execute() complete - success: false, recipes executed: 1
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteRecordsRecipeResults]' passed (3.094 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteReturnsInstallerReport]' started.
[2025-11-22 12:50:05.765] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:05.765] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:05.765] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:05.765] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:50:05.765] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:50:05.765] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844605.765
[2025-11-22 12:50:05.765] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:50:05.765] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:50:05.765] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:50:05.765] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:50:05.765] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:50:05.765] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:50:05.765] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:50:05.777] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:05.787] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:50:05.807] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:05.833] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:05.834] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:08.882] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:08.882] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:09.407] [INFO] [VHIDDeviceManager.swift:168 evaluateDaemonProcess()] âš ï¸ [VHIDManager] VHIDDevice process check timed out after 3s - fallback launchctl says running=false
[2025-11-22 12:50:09.474] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:09.474] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:09.474] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:09.474] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:09.474] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:09.542] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:09.542] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:09.542] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:09.543] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:09.543] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:09.543] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:09.543] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:09.543] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:09.543] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:09.543] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:09.543] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:09.543] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:09.610] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:09.676] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:09.743] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:09.743] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:09.810] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:09.810] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:09.876] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:09.876] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 4.112s
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:09.877] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:09.877] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:09.877] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 4.112s
[2025-11-22 12:50:09.877] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:09.943] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:09.943] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:10.010] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:10.077] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.066s)
[2025-11-22 12:50:10.077] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:10.650] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:10.650] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:10.650] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 4.885s
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=4.885s
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 4.885s
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 4.885s
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 4.885s
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 4.885s
[2025-11-22 12:50:10.650] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:10.650] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:10.650] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
[2025-11-22 12:50:10.650] [INFO] [InstallerEngine.swift:88 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Starting makePlan(for: install, context:)
[2025-11-22 12:50:10.650] [INFO] [InstallerEngine.swift:105 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Determined 5 actions for intent: install
[2025-11-22 12:50:10.651] [INFO] [InstallerEngine.swift:110 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Generated 5 recipes
[2025-11-22 12:50:10.651] [INFO] [InstallerEngine.swift:123 makePlan(for:context:)] âœ… [InstallerEngine] makePlan() complete - status: ready, recipes: 5
[2025-11-22 12:50:10.651] [INFO] [InstallerEngine.swift:390 execute(plan:using:)] âš™ï¸ [InstallerEngine] Starting execute(plan:, using:)
[2025-11-22 12:50:10.651] [INFO] [InstallerEngine.swift:409 execute(plan:using:)] âš™ï¸ [InstallerEngine] Executing recipe: install-bundled-kanata (type: installComponent)
[2025-11-22 12:50:10.651] [INFO] [PrivilegedOperationsCoordinator.swift:359 installBundledKanata()] ğŸ” [PrivCoordinator] Installing bundled Kanata binary
[2025-11-22 12:50:10.651] [INFO] [LaunchDaemonInstaller.swift:2898 installBundledKanataBinaryOnly()] ğŸ”§ [LaunchDaemon] Installing bundled kanata binary to system location
[2025-11-22 12:50:10.651] [INFO] [LaunchDaemonInstaller.swift:2906 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] CRITICAL: Bundled kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:50:10.651] [INFO] [LaunchDaemonInstaller.swift:2908 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] This indicates a packaging issue - the app bundle is missing the kanata binary
[2025-11-22 12:50:10.651] [INFO] [InstallerEngine.swift:451 execute(plan:using:)] âŒ [InstallerEngine] Recipe install-bundled-kanata failed: Operation failed: Bundled Kanata installation failed
[2025-11-22 12:50:10.651] [INFO] [InstallerEngine.swift:470 execute(plan:using:)] âœ… [InstallerEngine] execute() complete - success: false, recipes executed: 1
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteReturnsInstallerReport]' passed (4.887 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteStopsOnFirstFailure]' started.
[2025-11-22 12:50:10.652] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:10.652] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:10.652] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:10.652] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:50:10.652] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:50:10.652] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844610.652
[2025-11-22 12:50:10.652] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:50:10.652] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:50:10.652] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:50:10.652] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:50:10.652] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:50:10.652] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:50:10.652] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:50:10.658] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:10.663] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:10.679] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:50:10.679] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:50:10.679] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:50:10.679] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:50:10.679] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:50:10.680] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:50:10.680] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:50:10.681] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:10.720] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:10.720] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:11.293] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:11.293] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:11.293] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:11.294] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:11.294] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:11.294] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:11.362] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:11.363] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:11.363] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:11.363] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:11.363] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:11.430] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:11.497] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:11.566] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:11.566] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:11.633] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:11.633] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:11.700] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:11.700] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:11.700] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:11.700] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:11.700] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:11.700] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.048s
[2025-11-22 12:50:11.700] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:11.700] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:11.700] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 1.048s
[2025-11-22 12:50:11.701] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:11.701] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:11.701] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:11.769] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:11.769] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:11.836] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:11.903] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:50:11.903] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:12.477] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:50:12.477] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:12.477] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:12.477] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:12.477] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=1.825s
[2025-11-22 12:50:12.477] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.825s
[2025-11-22 12:50:12.477] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.825s
[2025-11-22 12:50:12.477] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:50:12.477] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:50:13.754] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:13.754] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:50:13.754] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:13.754] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.102s
[2025-11-22 12:50:13.754] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:50:13.754] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.102s
[2025-11-22 12:50:13.755] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.102s
[2025-11-22 12:50:13.755] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:13.755] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:13.755] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
[2025-11-22 12:50:13.755] [INFO] [InstallerEngine.swift:88 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Starting makePlan(for: install, context:)
[2025-11-22 12:50:13.755] [INFO] [InstallerEngine.swift:105 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Determined 5 actions for intent: install
[2025-11-22 12:50:13.755] [INFO] [InstallerEngine.swift:110 makePlan(for:context:)] ğŸ“‹ [InstallerEngine] Generated 5 recipes
[2025-11-22 12:50:13.755] [INFO] [InstallerEngine.swift:123 makePlan(for:context:)] âœ… [InstallerEngine] makePlan() complete - status: ready, recipes: 5
[2025-11-22 12:50:13.755] [INFO] [InstallerEngine.swift:390 execute(plan:using:)] âš™ï¸ [InstallerEngine] Starting execute(plan:, using:)
[2025-11-22 12:50:13.756] [INFO] [InstallerEngine.swift:409 execute(plan:using:)] âš™ï¸ [InstallerEngine] Executing recipe: install-bundled-kanata (type: installComponent)
[2025-11-22 12:50:13.756] [INFO] [PrivilegedOperationsCoordinator.swift:359 installBundledKanata()] ğŸ” [PrivCoordinator] Installing bundled Kanata binary
[2025-11-22 12:50:13.756] [INFO] [LaunchDaemonInstaller.swift:2898 installBundledKanataBinaryOnly()] ğŸ”§ [LaunchDaemon] Installing bundled kanata binary to system location
[2025-11-22 12:50:13.756] [INFO] [LaunchDaemonInstaller.swift:2906 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] CRITICAL: Bundled kanata binary not found at: /Applications/Xcode.app/Contents/Developer/usr/bin/Contents/Library/KeyPath/kanata
[2025-11-22 12:50:13.756] [INFO] [LaunchDaemonInstaller.swift:2908 installBundledKanataBinaryOnly()] âŒ [LaunchDaemon] This indicates a packaging issue - the app bundle is missing the kanata binary
[2025-11-22 12:50:13.756] [INFO] [InstallerEngine.swift:451 execute(plan:using:)] âŒ [InstallerEngine] Recipe install-bundled-kanata failed: Operation failed: Bundled Kanata installation failed
[2025-11-22 12:50:13.756] [INFO] [InstallerEngine.swift:470 execute(plan:using:)] âœ… [InstallerEngine] execute() complete - success: false, recipes executed: 1
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteStopsOnFirstFailure]' passed (3.106 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteWithEmptyPlan]' started.
[2025-11-22 12:50:13.758] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:13.758] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:13.758] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:13.758] [INFO] [InstallerEngine.swift:390 execute(plan:using:)] âš™ï¸ [InstallerEngine] Starting execute(plan:, using:)
[2025-11-22 12:50:13.758] [INFO] [InstallerEngine.swift:470 execute(plan:using:)] âœ… [InstallerEngine] execute() complete - success: true, recipes executed: 0
Test Case '-[KeyPathTests.InstallerEngineTests testExecuteWithEmptyPlan]' passed (0.001 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testInspectSystemReturnsConsistentContext]' started.
[2025-11-22 12:50:13.759] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:13.759] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:13.759] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:13.759] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:50:13.759] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:50:13.759] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844613.759
[2025-11-22 12:50:13.759] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:50:13.759] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:50:13.759] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:50:13.760] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:50:13.760] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:50:13.771] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:13.781] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:13.801] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:50:13.801] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:50:13.801] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:50:13.801] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:50:13.801] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:50:13.802] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:13.828] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:13.828] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:14.402] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:14.402] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:14.402] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:14.402] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:14.402] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:14.402] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:14.470] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:14.471] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:14.471] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:14.471] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:14.471] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:14.540] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:14.607] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:14.675] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:14.675] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:14.741] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:14.741] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:14.808] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:14.808] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.049s
[2025-11-22 12:50:14.809] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:14.809] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 1.049s
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:14.809] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:14.809] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:50:14.809] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:14.876] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:14.877] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:14.944] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:15.012] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:50:15.012] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:15.585] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:15.585] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:15.585] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:15.585] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:15.585] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.826s
[2025-11-22 12:50:15.585] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:50:15.585] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=0.777s
[2025-11-22 12:50:15.586] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.826s
[2025-11-22 12:50:15.586] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:50:16.810] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:16.810] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:16.810] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:50:16.811] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.051s
[2025-11-22 12:50:16.811] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:50:16.811] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.052s
[2025-11-22 12:50:16.811] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.052s
[2025-11-22 12:50:16.811] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:16.811] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:16.811] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
[2025-11-22 12:50:16.812] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:50:16.812] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:50:16.812] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844616.812
[2025-11-22 12:50:16.812] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:50:16.812] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:50:16.812] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:50:16.812] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:50:16.812] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:50:16.813] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:50:16.813] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:50:16.826] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:16.836] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:16.856] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:50:16.857] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:16.881] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:16.881] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:17.455] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:17.455] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:17.455] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:17.455] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:17.455] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:17.455] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:17.523] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:17.523] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:17.523] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:17.524] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:17.524] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:17.524] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:17.524] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:17.524] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:17.524] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:17.524] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:17.524] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:17.524] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:17.592] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:17.660] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:17.726] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:17.727] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:17.795] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:17.795] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:17.862] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:17.862] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 1.050s
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:17.863] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:17.863] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:17.863] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 1.051s
[2025-11-22 12:50:17.863] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:17.929] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:17.929] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:17.997] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:18.066] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:18.066] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:18.640] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.069s)
[2025-11-22 12:50:18.640] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:18.640] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:18.640] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:18.640] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 1.828s
[2025-11-22 12:50:18.640] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
[2025-11-22 12:50:18.641] [INFO] [SystemValidator.swift:355 checkPermissions()] ğŸ” [SystemValidator] Oracle snapshot: ready=false, age=1.828s
[2025-11-22 12:50:18.641] [INFO] [SystemValidator.swift:211 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 2 (Permissions) completed in 1.828s
[2025-11-22 12:50:18.641] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 80% (4/5 steps)
[2025-11-22 12:50:19.932] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:19.932] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:19.932] [INFO] [SystemValidator.swift:328 checkHelper()] ğŸ” [SystemValidator] Helper state: registeredButUnresponsive Helper registered but XPC communication failed
[2025-11-22 12:50:19.932] [INFO] [SystemValidator.swift:202 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 1 (Helper) completed in 3.120s
[2025-11-22 12:50:19.932] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 100% (5/5 steps)
[2025-11-22 12:50:19.932] [INFO] [SystemValidator.swift:283 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 COMPLETE: Total duration 3.120s
[2025-11-22 12:50:19.932] [INFO] [SystemValidator.swift:297 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Validation #1 complete in 3.120s
[2025-11-22 12:50:19.932] [INFO] [SystemValidator.swift:299 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Result: ready=false, blocking=9, total=9
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:135 validateSystemCompatibility()] ğŸ” [SystemRequirements] Validating system compatibility
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:147 validateSystemCompatibility()] âœ… [SystemRequirements] Modern macOS detected: 26.0.1
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:190 validateSystemCompatibility()] ğŸ” [SystemRequirements] Compatibility check complete: âœ… Compatible
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:19.933] [INFO] [SystemRequirements.swift:102 detectMacOSVersion()] ğŸ” [SystemRequirements] Detected macOS version: 26.0.1
[2025-11-22 12:50:19.933] [INFO] [InstallerEngine.swift:78 inspectSystem()] âœ… [InstallerEngine] inspectSystem() complete - ready=false, blocking=9
Test Case '-[KeyPathTests.InstallerEngineTests testInspectSystemReturnsConsistentContext]' passed (6.176 seconds).
Test Case '-[KeyPathTests.InstallerEngineTests testInspectSystemReturnsSystemContext]' started.
[2025-11-22 12:50:19.936] [INFO] [ProcessLifecycleManager.swift:43 init()] ğŸ—ï¸ [ProcessLifecycleManager] Initialized with simplified PID-based tracking and caching
[2025-11-22 12:50:19.936] [INFO] [SystemValidator.swift:63 init(launchDaemonInstaller:vhidDeviceManager:processLifecycleManager:kanataManager:)] ğŸ” [SystemValidator] Initialized (stateless, no cache)
[2025-11-22 12:50:19.936] [INFO] [InstallerEngine.swift:35 init(processLifecycleManager:kanataManager:)] ğŸ”§ [InstallerEngine] Initialized
[2025-11-22 12:50:19.936] [INFO] [InstallerEngine.swift:53 inspectSystem()] ğŸ” [InstallerEngine] Starting inspectSystem()
[2025-11-22 12:50:19.936] [INFO] [SystemValidator.swift:143 performValidationBody(progressCallback:)] ğŸ” [SystemValidator] Starting validation #1
[2025-11-22 12:50:19.936] [INFO] [SystemValidator.swift:174 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Validation #1 START: 1763844619.936
[2025-11-22 12:50:19.936] [INFO] [SystemValidator.swift:312 checkHelper()] ğŸ” [SystemValidator] Checking privileged helper
[2025-11-22 12:50:19.936] [INFO] [SystemValidator.swift:344 checkPermissions()] ğŸ” [SystemValidator] Checking permissions via Oracle
[2025-11-22 12:50:19.936] [INFO] [SystemValidator.swift:365 checkComponents()] ğŸ” [SystemValidator] Checking components
[2025-11-22 12:50:19.936] [INFO] [KanataBinaryDetector.swift:66 detectCurrentStatus()] ğŸ” [KanataBinaryDetector] Starting unified kanata binary detection
[2025-11-22 12:50:19.936] [INFO] [PermissionOracle.swift:173 currentSnapshot()] ğŸ”® [Oracle] Test mode snapshot generated (non-blocking)
[2025-11-22 12:50:19.936] [INFO] [KanataBinaryDetector.swift:81 detectCurrentStatus()] âŒ [KanataBinaryDetector] No kanata binary found
[2025-11-22 12:50:19.936] [INFO] [VHIDDeviceManager.swift:50 detectInstallation()] ğŸ” [VHIDManager] Manager app exists at /Applications/.Karabiner-VirtualHIDDevice-Manager.app/Contents/MacOS/Karabiner-VirtualHIDDevice-Manager: true
[2025-11-22 12:50:19.948] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:19.958] [INFO] [HelperManager.swift:194 isHelperInstalled()] â„¹ï¸ [HelperManager] launchctl reports helper present while SMAppService status=SMAppServiceStatus(rawValue: 3)
[2025-11-22 12:50:19.977] [INFO] [HelperManager.swift:830 verifyEmbeddedHelperSignature()] ğŸ”’ [HelperManager] Embedded helper signature looks valid
[2025-11-22 12:50:19.977] [INFO] [HelperManager.swift:105 getConnection()] ğŸ”— [HelperManager] Creating XPC connection to com.keypath.helper
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:129 getConnection()] âœ… [HelperManager] XPC connection established (PID: 0)
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:228 getHelperVersion()] ğŸ“¤ [HelperManager] Calling proxy.getVersion()
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:243 getHelperVersion()] ğŸ“¤ [HelperManager] proxy.getVersion() call dispatched, waiting for callback
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:121 getConnection()] âš ï¸ [HelperManager] XPC connection interrupted - will reconnect
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:578 getRemoteProxy(errorHandler:)] âŒ [HelperManager] XPC proxy error: Couldnâ€™t communicate with a helper application.
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:584 getRemoteProxy(errorHandler:)] âš ï¸ [HelperManager] XPC connection interrupted - this may indicate:
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:585 getRemoteProxy(errorHandler:)]    1. Helper signature validation failed (app updated but not restarted)
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:587 getRemoteProxy(errorHandler:)]    2. Helper process crashed
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:588 getRemoteProxy(errorHandler:)]    3. Helper was killed by the system
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:589 getRemoteProxy(errorHandler:)] ğŸ’¡ If you just updated KeyPath, try restarting the app
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:116 getConnection()] âŒ [HelperManager] XPC connection invalidated
[2025-11-22 12:50:19.978] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:23.003] [INFO] [VHIDDeviceManager.swift:168 evaluateDaemonProcess()] âš ï¸ [VHIDManager] VHIDDevice process check timed out after 3s - fallback launchctl says running=false
[2025-11-22 12:50:23.053] [INFO] [HelperManager.swift:248 getHelperVersion()] âš ï¸ [HelperManager] getVersion timed out - clearing connection cache
[2025-11-22 12:50:23.053] [INFO] [HelperManager.swift:160 clearConnection()] ğŸ§¹ [HelperManager] Clearing XPC connection cache
[2025-11-22 12:50:23.071] [INFO] [VHIDDeviceManager.swift:88 detectRunning()] â³ [VHIDManager] Timeout while checking daemon; retrying to avoid false negatives
[2025-11-22 12:50:26.644] [INFO] [VHIDDeviceManager.swift:168 evaluateDaemonProcess()] âš ï¸ [VHIDManager] VHIDDevice process check timed out after 3s - fallback launchctl says running=false
[2025-11-22 12:50:26.712] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:26.713] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:26.713] [INFO] [VHIDDeviceManager.swift:343 getInstalledVersion()] ğŸ” [VHIDManager] Installed daemon version: 5.0.0
[2025-11-22 12:50:26.713] [INFO] [VHIDDeviceManager.swift:374 hasVersionMismatch()] âœ… [VHIDManager] Version compatible: v5.0.0
[2025-11-22 12:50:26.713] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:26.780] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:105 determineServiceManagementState()] ğŸ” [KanataDaemonManager] State determination:
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:106 determineServiceManagementState()]   - Legacy plist exists: false
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:107 determineServiceManagementState()]   - SMAppService status: 3 (SMAppServiceStatus(rawValue: 3))
[2025-11-22 12:50:26.781] [INFO] [KanataDaemonManager.swift:133 determineServiceManagementState()] ğŸ§ª [KanataDaemonManager] Test mode - treating missing plist as uninstalled
[2025-11-22 12:50:26.781] [INFO] [LaunchDaemonInstaller.swift:669 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Kanata service state: Uninstalled
[2025-11-22 12:50:26.781] [INFO] [LaunchDaemonInstaller.swift:696 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] Service not installed (state: Uninstalled)
[2025-11-22 12:50:26.781] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:26.849] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:26.916] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhiddaemon loaded: false
[2025-11-22 12:50:26.985] [INFO] [LaunchDaemonInstaller.swift:721 isServiceLoaded(serviceID:)] ğŸ” [LaunchDaemon] (system) Service com.keypath.karabiner-vhidmanager loaded: false
[2025-11-22 12:50:26.985] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:27.052] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:27.052] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhidmanager
[2025-11-22 12:50:27.120] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhidmanager not found in system domain
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:393 checkComponents()] ğŸ” [SystemValidator] Components: kanata=false, driver=true, daemon=false, vhid=false, vhidVersionMismatch=false
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:220 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 3 (Components) completed in 7.184s
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:411 checkConflicts()] ğŸ” [SystemValidator] Checking for conflicts
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 20% (1/5 steps)
[2025-11-22 12:50:27.120] [INFO] [ProcessLifecycleManager.swift:117 detectConflicts()] ğŸ” [ProcessLifecycleManager] Detecting conflicts...
[2025-11-22 12:50:27.120] [INFO] [ProcessLifecycleManager.swift:121 detectConflicts()] ğŸ§ª [TestEnvironment] Skipping process conflict detection - returning clean state
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:436 checkConflicts()] ğŸ” [SystemValidator] Total conflicts: 0 (0 kanata, 0 karabiner)
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:477 checkHealth()] ğŸ” [SystemValidator] Checking system health
[2025-11-22 12:50:27.120] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.kanata
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:229 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 4 (Conflicts) completed in 7.184s
[2025-11-22 12:50:27.120] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 40% (2/5 steps)
[2025-11-22 12:50:27.188] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.kanata not found in system domain
[2025-11-22 12:50:27.188] [INFO] [LaunchDaemonInstaller.swift:735 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] HEALTH CHECK (system/print) for: com.keypath.karabiner-vhiddaemon
[2025-11-22 12:50:27.256] [INFO] [LaunchDaemonInstaller.swift:758 isServiceHealthy(serviceID:)] ğŸ” [LaunchDaemon] com.keypath.karabiner-vhiddaemon not found in system domain
[2025-11-22 12:50:27.324] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.068s)
[2025-11-22 12:50:27.324] [INFO] [VHIDDeviceManager.swift:77 detectRunning()] â³ [VHIDManager] Daemon reported not running; retrying shortly to avoid false positives
[2025-11-22 12:50:27.898] [INFO] [VHIDDeviceManager.swift:199 evaluateDaemonProcess()] ğŸ” [VHIDManager] VHIDDevice daemon health: NOT RUNNING (took 0.067s)
[2025-11-22 12:50:27.898] [INFO] [VHIDDeviceManager.swift:314 detectConnectionHealth()] ğŸ” [VHIDManager] detectConnectionHealth() -> isRunning=false
[2025-11-22 12:50:27.898] [INFO] [VHIDDeviceManager.swift:316 detectConnectionHealth()] ğŸ” [VHIDManager] Process health check failed - daemon not running
[2025-11-22 12:50:27.898] [INFO] [SystemValidator.swift:487 checkHealth()] ğŸ” [SystemValidator] Health: kanata=false, daemon=false (launchctl), vhid=false
[2025-11-22 12:50:27.898] [INFO] [SystemValidator.swift:238 performValidationBody(progressCallback:)] â±ï¸ [TIMING] Step 5 (Health) completed in 7.962s
[2025-11-22 12:50:27.898] [INFO] [SystemValidator.swift:161 performValidationBody(progressCallback:)] ğŸ“Š [SystemValidator] Progress: 60% (3/5 steps)
KeyPathAppKit/SystemValidator.swift:351: Assertion failed: Oracle snapshot is 8.0s old - Oracle cache may be broken
