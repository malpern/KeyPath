;; Generated by KeyPath — https://github.com/malpern/KeyPath
;; Enabled: Caps Lock → Escape/Control, Home Row Mods, Double-Shift Caps, Navigation Layer, Quick Actions

(defcfg
  process-unmapped-keys yes
  danger-enable-cmd yes
  concurrent-tap-hold yes
)

;; === Fake Keys for Layer Notifications ===
;; Used to broadcast layer changes via TCP (layer-while-held doesn't do this natively)
(deffakekeys
  kp-layer-nav-enter (push-msg "layer:nav")
  kp-layer-nav-exit (push-msg "layer:base")
)

;; === Aliases ===
(defalias
  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Caps Lock → Escape when tapped, Control when held
  ;; Uses tap-hold-press: hold activates immediately when another key is pressed
  ;; ─────────────────────────────────────────────────────────────────────────────
  cap (tap-hold-press 200 200 esc lctl)

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Home Row Mods (GASC layout - left hand)
  ;; Tap = letter, Hold = modifier
  ;; Uses tap-hold-press for responsive modifier activation
  ;; ─────────────────────────────────────────────────────────────────────────────
  hrm-a (tap-hold-press 200 150 a lmet)   ;; A → Cmd (GUI/Meta)
  hrm-s (tap-hold-press 200 150 s lalt)   ;; S → Alt (Option)
  hrm-d (tap-hold-press 200 150 d lsft)   ;; D → Shift
  hrm-f (tap-hold-press 200 150 f lctl)   ;; F → Control

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Home Row Mods (GASC layout - right hand, mirrored)
  ;; ─────────────────────────────────────────────────────────────────────────────
  hrm-j (tap-hold-press 200 150 j rctl)   ;; J → Control
  hrm-k (tap-hold-press 200 150 k rsft)   ;; K → Shift
  hrm-l (tap-hold-press 200 150 l ralt)   ;; L → Alt (Option)
  hrm-; (tap-hold-press 200 150 ; rmet)   ;; ; → Cmd (GUI/Meta)

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Navigation Layer Toggle
  ;; Hold Space to activate navigation layer (Vim-style HJKL arrows)
  ;; ─────────────────────────────────────────────────────────────────────────────
  nav (tap-hold-press 200 200 spc (layer-while-held nav))

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Double-tap Shift for Caps Lock (tap-dance)
  ;; Single tap = Shift, Double tap = Caps Lock
  ;; ─────────────────────────────────────────────────────────────────────────────
  td-sft (tap-dance 200 (lsft caps))

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Backspace → Delete when held with modifiers
  ;; Tap = Backspace, Hold = Delete (forward delete)
  ;; ─────────────────────────────────────────────────────────────────────────────
  bsdel (tap-hold-press 200 200 bspc del)

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Quick text expansion macros (useful for common phrases)
  ;; Note: S-2 = @ on US keyboard, S-. = > on US keyboard
  ;; ─────────────────────────────────────────────────────────────────────────────
  email (macro m y S-2 e x a m p l e . c o m)
  arrow (macro - S-.)
  fatarrow (macro = S-.)

  ;; ─────────────────────────────────────────────────────────────────────────────
  ;; Application launcher shortcuts via push-msg (TCP integration)
  ;; These send messages to KeyPath which can trigger app launches
  ;; ─────────────────────────────────────────────────────────────────────────────
  term (push-msg "launch:terminal")
  browser (push-msg "launch:safari")
)

;; === Chord Mappings (simultaneous key presses) ===
;; Press both keys at the same time for a different action
(defchordsv2
  ;; Double-shift = Caps Lock (alternative to tap-dance)
  (lsft rsft) caps 50 all-released ()

  ;; J+K pressed together = Escape (common vim-like binding)
  (j k) esc 50 all-released ()

  ;; D+F pressed together = Tab (easy reach combo)
  (d f) tab 50 all-released ()

  ;; S+D pressed together = Backspace (quick delete)
  (s d) bspc 50 all-released ()
)

;; === Source Keys ===
;; Keys that KeyPath intercepts and remaps
(defsrc
  ;; Top row - function keys preserved for system use
  esc  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12

  ;; Number row
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc

  ;; QWERTY row
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \

  ;; Home row (where the magic happens)
  caps a    s    d    f    g    h    j    k    l    ;    '    ret

  ;; Bottom row
  lsft z    x    c    v    b    n    m    ,    .    /    rsft

  ;; Modifier row
  lctl lmet lalt           spc            ralt rmet rctl
)

;; === Base Layer ===
;; Default keyboard layout with home row mods and tap-hold enhancements
(deflayer base
  ;; Top row - pass through (underscore = transparent)
  _    _    _    _    _    _    _    _    _    _    _    _    _

  ;; Number row
  _    _    _    _    _    _    _    _    _    _    _    _    _    @bsdel

  ;; QWERTY row - standard
  _    _    _    _    _    _    _    _    _    _    _    _    _    _

  ;; Home row - tap-hold mods (GASC layout)
  @cap @hrm-a @hrm-s @hrm-d @hrm-f _ _ @hrm-j @hrm-k @hrm-l @hrm-; _ _

  ;; Bottom row - tap-dance shift
  @td-sft _ _ _ _ _ _ _ _ _ _ @td-sft

  ;; Modifier row - space activates nav layer when held
  _    _    _              @nav           _    _    _
)

;; === Nav Layer ===
;; Vim-style navigation activated by holding Space
;; HJKL = Arrow keys, with modifiers for word/line jumping
(deflayer nav
  ;; Top row - layer utilities
  _    _    _    _    _    _    _    _    _    _    _    _    _

  ;; Number row - quick number access
  _    _    _    _    _    _    _    _    _    _    _    _    _    del

  ;; QWERTY row - additional nav shortcuts
  _    _    _    end  _    _    _    pgup _    _    _    _    _    _

  ;; Home row - HJKL navigation (Vim-style)
  _    home _    _    _    _    left down up   rght _    _    _

  ;; Bottom row - word jumping with modifiers
  _    _    _    _    _    pgdn _    _    _    _    _    _

  ;; Modifier row
  _    _    _              _              _    _    _
)

;; ═══════════════════════════════════════════════════════════════════════════════
;; KEYPATH R1 SAMPLE CONFIGURATION
;; ═══════════════════════════════════════════════════════════════════════════════
;;
;; This configuration demonstrates features available in KeyPath R1:
;;
;; ✓ Simple key remaps (caps → escape)
;; ✓ Tap-hold dual-function keys (tap = one thing, hold = another)
;; ✓ Home Row Mods (ASDF/JKL; as modifiers when held)
;; ✓ Tap-dance (double-tap shift for caps lock)
;; ✓ Chord mappings (press two keys simultaneously)
;; ✓ Layer switching (space-bar navigation layer)
;; ✓ Macros (text expansion)
;; ✓ Push-msg for KeyPath TCP integration
;;
;; Tap-hold strategies used:
;; - tap-hold-press: Hold activates when ANY other key is pressed
;;   Best for: Home row mods, responsive modifier activation
;;
;; Other strategies available (via manual config editing):
;; - tap-hold: Pure timeout-based (hold after X ms)
;; - tap-hold-release: Hold activates on press+release of another key
;; - tap-hold-release-keys: Early tap on specific keys only
;; - tap-hold-tap-keys: Specific keys always trigger tap
;; - tap-hold-except-keys: Certain keys bypass hold detection
;;
;; For more information:
;; - KeyPath: https://github.com/malpern/KeyPath
;; - Kanata config guide: https://github.com/jtroo/kanata/blob/main/docs/config.adoc
;; - Home Row Mods: https://precondition.github.io/home-row-mods
;;
;; ═══════════════════════════════════════════════════════════════════════════════
